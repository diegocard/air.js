!function(t){"use strict";function e(t){d(function(){throw t})}function r(e){return this.then(e,t)}function n(e){return this.then(t,e)}function o(e,r){return this.then(function(t){return p(e)?e.apply(null,f(t)?t:[t]):T.onlyFuncs?t:e},r||t)}function i(t){function e(){t()}return this.then(e,e),this}function s(t){return this.then(function(e){return p(t)?t.apply(null,f(e)?e.splice(0,0,void 0)&&e:[void 0,e]):T.onlyFuncs?e:t},function(e){return t(e)})}function u(r){return this.then(t,r?function(t){throw r(t),t}:e)}function c(t,e){var r=m(t);if(1===r.length&&f(r[0])){if(!r[0].length)return T.fulfilled([]);r=r[0]}var n=[],o=T(),i=r.length;if(i)for(var s=function(t){r[t]=T.promisify(r[t]),r[t].then(function(s){n[t]=e?r[t]:s,--i||o.resolve(n)},function(s){e?(n[t]=r[t],--i||o.resolve(n)):o.reject(s)})},u=0,c=i;c>u;u++)s(u);else o.resolve(n);return o.promise}function a(t,e){return t.then(p(e)?e:function(){return e})}function l(t){var e=m(t);1===e.length&&f(e[0])&&(e=e[0]);for(var r=T(),n=0,o=e.length,i=T.resolved();o>n;n++)i=a(i,e[n]);return r.resolve(i),r.promise}var d,p=function(t){return"function"==typeof t},f=function(t){return Array.isArray?Array.isArray(t):t instanceof Array},y=function(t){return!(!t||!(typeof t).match(/function|object/))},h=function(e){return e===!1||e===t||null===e},m=function(t,e){return[].slice.call(t,e)},v="undefined",w=typeof TypeError===v?Error:TypeError;if(typeof process!==v&&process.nextTick)d=process.nextTick;else if(typeof MessageChannel!==v){var g=new MessageChannel,j=[];g.port1.onmessage=function(){j.length&&j.shift()()},d=function(t){j.push(t),g.port2.postMessage(0)}}else d=function(t){setTimeout(t,0)};var T=function(e){function c(){if(0!==v){var t,e=g,r=0,n=e.length,o=~v?0:1;for(g=[];n>r;r++)(t=e[r][o])&&t(f)}}function a(t){function e(t){return function(e){return r?void 0:(r=!0,t(e))}}var r=!1;if(v)return this;try{var n=y(t)&&t.then;if(p(n)){if(t===j)throw new w("Promise can't resolve itself");return n.call(t,e(a),e(l)),this}}catch(o){return e(l)(o),this}return m(function(){f=t,v=1,c()}),this}function l(t){return v||m(function(){try{throw t}catch(e){f=e}v=-1,c()}),this}var f,m=(t!==e?e:T.alwaysAsync)?d:function(t){t()},v=0,g=[],j={then:function(t,e){var r=T();return g.push([function(e){try{h(t)?r.resolve(e):r.resolve(p(t)?t(e):T.onlyFuncs?e:t)}catch(n){r.reject(n)}},function(t){if((h(e)||!p(e)&&T.onlyFuncs)&&r.reject(t),e)try{r.resolve(p(e)?e(t):e)}catch(n){r.reject(n)}}]),0!==v&&m(c),r.promise},success:r,error:n,otherwise:n,apply:o,spread:o,ensure:i,nodify:s,rethrow:u,isPending:function(){return 0===v},getStatus:function(){return v}};return j.toSource=j.toString=j.valueOf=function(){return f===t?this:f},{promise:j,resolve:a,fulfill:a,reject:l}};T.deferred=T.defer=T,T.nextTick=d,T.alwaysAsync=!0,T.onlyFuncs=!0,T.resolved=T.fulfilled=function(t){return T(!0).resolve(t).promise},T.rejected=function(t){return T(!0).reject(t).promise},T.wait=function(t){var e=T();return setTimeout(e.resolve,t||0),e.promise},T.delay=function(t,e){var r=T();return setTimeout(function(){try{r.resolve(p(t)?t.apply(null):t)}catch(e){r.reject(e)}},e||0),r.promise},T.promisify=function(t){return t&&p(t.then)?t:T.resolved(t)},T.all=function(){return c(arguments,!1)},T.resolveAll=function(){return c(arguments,!0)},T.sequence=function(){return l(arguments)},T.nodeCapsule=function(t,e){return e||(e=t,t=void 0),function(){var r=T(),n=m(arguments);n.push(function(t,e){t?r.reject(t):r.resolve(arguments.length>2?m(arguments,1):e)});try{e.apply(t,n)}catch(o){r.reject(o)}return r.promise}},typeof window!==v&&(window.D=T),typeof module!==v&&module.exports&&(module.exports=T)}(),dry={$:function(t){return new dry.Dom(t)},apps:{},app:function(t,e){return this.apps[t]||(this.apps[t]=new dry.App(t,e))},navigate:function(t){window.location.href=t||""},run:function(t){var e;for(e in dry.apps)dry.apps[e].router.run(t)},Promise:D,promise:function(){var t=D();return t.constructor=dry.Promise,t}},dry.settings={DEFAULT_CONTROLLER_NAME:"default",DEFAULT_CONTROLLER_METHOD:"default",AJAX_TIMEOUT:1e4},dry.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)},dry.isObject=function(t){return t===Object(t)&&!dry.isFunction(t)},dry.isStrictlyObject=function(t){return dry.isObject(t)&&!dry.isArray(t)},dry.isBoolean=function(t){return t===!0||t===!1},dry.isString=function(t){return"[object String]"===Object.prototype.toString.call(t)},dry.isFunction=function(t){return"[object Function]"===Object.prototype.toString.call(t)},dry.isUndefined=function(t){return"undefined"==typeof t},dry.isNumeric=function(t){return!isNaN(parseFloat(t))&&isFinite(t)},dry.keys=function(t){var e,r=[];for(e in t)t.hasOwnProperty(e)&&r.push(e);return r},dry.each=function(t,e,r){var n,o,i;if(dry.isStrictlyObject(t))for(i=dry.keys(t),n=0,o=i.length;o>n;n++)e.call(r,t[i[n]],i[n],t);else for(n=0,o=t.length;o>n;n++)e.call(r,t[n],n,t)},dry.jsonp=function(t,e){var r="dry_jsonp_callback_"+Math.round(1e5*Math.random());window[r]=function(t){delete window[r],document.body.removeChild(n),e(t)};var n=document.createElement("script");n.src=t+(t.indexOf("?")>=0?"&":"?")+"callback="+r,document.body.appendChild(n)},dry.ajax=function(t){var e,r,n,o,i=t.type||"GET",s=t.data||{},u=t.headers||{},c=t.url,a=t.timeout||dry.settings.AJAX_TIMEOUT,l=dry.promise(),d=function(){var t;if(window.XMLHttpRequest)t=new XMLHttpRequest;else if(window.ActiveXObject)try{t=new ActiveXObject("Msxml2.XMLHTTP")}catch(e){t=new ActiveXObject("Microsoft.XMLHTTP")}return t},p=function(){e.abort(),l.reject(e)};try{e=d()}catch(f){return l.reject("XHR not supported on this browser"),l.promise}r=dry.param(s),"GET"===i&&r&&(c+="?"+r,r=null),e.open(i,c),e.setRequestHeader("Content-type","application/x-www-form-urlencoded");for(n in u)u.hasOwnProperty(n)&&e.setRequestHeader(n,u[n]);return a&&(o=setTimeout(p,a)),e.onreadystatechange=function(){var t,r;if(a&&clearTimeout(o),4===e.readyState)if(t=!e.status||(e.status<200||e.status>=300)&&304!==e.status)l.reject(e);else{try{r=JSON.parse(this.responseText)}catch(n){r=this.responseText}l.resolve(r)}},e.send(r),l.promise.success(t.success).error(t.error)},dry.each(["GET","POST","PUT","DELETE"],function(t){dry[t.toLowerCase()]=function(e,r,n,o){return dry.ajax({type:t,url:e,data:r,success:n,error:o})}}),dry.getJSON=function(t,e,r){return dry.ajax({type:"GET",url:t,success:e,error:r})},dry.param=function(t){var e,r=/%20/g,n=/\[\]$/,o=[],i=function(t,e){e=dry.isFunction(e)?e():null==e?"":e,o[o.length]=encodeURIComponent(t)+"="+encodeURIComponent(e)},s=function(t,e,r){var o;if(dry.isArray(e))dry.each(e,function(e,o){n.test(t)?r(t,e):s(t+"["+("object"==typeof e?o:"")+"]",e,r)});else if(dry.isObject(e))for(o in e)s(t+"["+o+"]",e[o],r);else r(t,e)};if(dry.isArray(t)||!dry.isStrictlyObject(t))dry.each(t,function(){i(this.name,this.value)});else for(e in t)s(e,t[e],i);return o.join("&").replace(r,"+")},dry.Dom=function(t){this.element=document.querySelector(t)},dry.Dom.prototype.html=function(t){return t?(this.element.innerHTML=t,this):this.element.innerHTML},dry.Dom.prototype.on=function(t,e){this.element.addEventListener(t,e)},dry.Dom.prototype.off=function(t,e){this.element.removeEventListener(t,e)},dry.Dom.prototype.trigger=function(t,e){var r;window.CustomEvent?r=new CustomEvent(t,{detail:e}):(r=document.createEvent("CustomEvent"),r.initCustomEvent(t,!0,!0,e)),this.element.dispatchEvent(r)},dry.App=function(t,e){this.name=t,this.options=e||{},this.routes=this.options.routes||{},this.router=new dry.Router(this.name),this.filters=this.options.filters||{},this.controllers=this.options.controllers||{},this.views=this.options.views||{},this.modelDefinitions=this.options.models||{}},dry.App.prototype.controller=function(t,e){var r,n=this;return dry.isUndefined(e)?r=this.controllers[t]:(r=new dry.Controller(t,e),this.controllers[t]=r,dry.each(e,function(t,e){n.router.addRoute(r,e,t)})),r},dry.App.prototype.redirect=function(t,e,r){this.controllers[t].invokeMethod(e,r)},dry.App.prototype.filter=function(t,e,r){return dry.isUndefined(e)&&dry.isUndefined(r)?this.views[t]:(this.filters[t]=new dry.Filter(t,e,r),void 0)},dry.App.prototype.view=function(t,e){return dry.isUndefined(e)?this.views[t]:(this.views[t]=new dry.View(t,e),void 0)},dry.App.prototype.init=function(){this.router.init()},dry.App.prototype.model=function(t,e){return e?(this.modelDefinitions[t]=e,void 0):new dry.Model(t,this.modelDefinitions[t])},dry.Router=function(){this.rules={},this.routes=[]},dry.Router.prototype.routeCallback=function(t,e){return function(r){t.invokeMethod(e,r.params)}},dry.Router.prototype.addRoute=function(t,e){var r=t.name===dry.settings.DEFAULT_CONTROLLER_NAME?"":t.name,n=e===dry.settings.DEFAULT_CONTROLLER_NAME?"":e,o=n?r+"/"+n:r;this.routes.push(o),this.add(o,this.routeCallback(t,e))},dry.Router.prototype.add=function(t,e){for(var r=t.split("/"),n=this.rules,o=0;o<r.length;++o){var i=r[o],s=i.length&&":"==i.charAt(0)?":":i;n[s]?n=n[s]:(n=n[s]={},":"==s&&(n["@name"]=i.slice(1)))}n["@"]=e},dry.Router.prototype.run=function(t){t&&t.length&&(t=t.replace("/?","?"),"/"==t.charAt(0)&&(t=t.slice(1)),t.length&&"/"==t.slice(-1)&&(t=t.slice(0,-1)));var e=this.rules,r=t.split("?",2),n=r[0].split("/",50),o={};return function(){for(var t=0;t<n.length&&e;++t){var r=n[t],i=e[r.toLowerCase()];!i&&(i=e[":"])&&(o[i["@name"]]=r),e=i}}(),function(t){for(var e=t.split("&",50),r=0;r<e.length;++r){var n=e[r].split("=",2);2==n.length&&(o[n[0]]=n[1])}}(2==r.length?r[1]:""),e&&e["@"]?(e["@"]({url:t,params:o}),!0):!1},dry.Router.prototype.init=function(){var t=this,e=function(){var e=location.hash||"#";t.run(e.substr(1))};window.addEventListener("hashchange",e),e()},dry.Model=function(t,e){e=e||{},this.name=t,this.attributes=e.attributes||{},this.validations=[];var r=this;dry.each(e,function(t,e){var n,o,i;dry.isString(t)&&(n=t.split(" "),o=n[0],i=n[1],r[e]=r.endpointMethod(o,i))})},dry.Model.prototype.endpointMethod=function(t,e){return function(r,n,o){var i,s,u=e,c=this.attributes;for(i in c)u=u.replace("{"+i+"}",c[i]);for(s in r)u=u.replace("{"+s+"}",r[s]);return dry.ajax({url:u,type:t,data:r,success:n,error:o})}},dry.Model.prototype.set=function(t,e){var r=dry.isStrictlyObject(t)?t:{name:e},n=this;return dry.each(r,function(t,e){n.attributes[e]=t}),this},dry.Model.prototype.get=function(t){return this.attributes[t]},dry.Model.prototype.validate=function(t,e){return this.validations[t].push(e),this},dry.Model.prototype.isValid=function(t){for(var e,r,n=[t]||dry.keys(this.attributes),o=0,i=0,s=n.length,u=!0;u&&s>o;){for(i=0,r=this.validations[n[o]],e=r.length;u&&e>i;)u=r[i].apply(this),i++;o++}return u||o},dry.Filter=function(t,e,r){this.name=t,this.condition=e,this.action=r},dry.Filter.prototype.runFilter=function(){var t=this.condition();return t&&this.action&&this.action(),t},dry.Controller=function(t,e){this.name=t,this.methods=e||{}},dry.Controller.prototype.invokeMethod=function(t,e){var r,n,o=this,i=this.methods[t];i?r=i.call(this,e):(n=this.name+"/"+t,r=new dry.View(n,{templateData:e,controller:this})),r&&dry.Promise.promisify(r).then(function(t){t.constructor===dry.View&&(t.controller=t.controller||o,t.render())})},dry.Controller.prototype.redirect=function(t,e){this.invokeMethod(t,e)},dry.Template=function(t,e){this.name=t,dry.isFunction(e)?this.compile=e:this.templateId=e||'script[data-dry="'+t+'"]'},dry.Template.prototype.cache=[],dry.Template.prototype.compile=function(t){var e=this.cache[this.name]||dry.$(this.templateId).element.innerHTML,r=new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+e.replace(/[\r\t\n]/g," ").split("<%").join("	").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("	").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}return p.join('');");return r(t.attributes)},dry.View=function(t,e){e=e||{},this.name=t,this.el=e.el||':not(script)[data-dry~="'+t+'"]',this.model=e.model||new dry.Model(t),this.template=new dry.Template(t,e.template),this.controller=e.controller,this.events=e.events||{}},dry.View.prototype.render=function(){var t=dry.$(this.el),e=this.template.compile(this.model),r=this.events,n=this;t.html(e),dry.each(r,function(t,e){n.addEvent(e,t)})},dry.View.prototype.addEvent=function(t,e){var r,n,o;r=t.split(" "),n=r[1],o=r[0],dry.isString(e)&&(e=function(t){this.controller.invokeMethod(e,t)}),dry.$(n).on(o,e)};