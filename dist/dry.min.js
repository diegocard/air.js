dry={$:function(t){return new dry.Dom(t)},apps:{},app:function(t,e){return this.apps[t]||(this.apps[t]=new dry.App(t,e))},navigate:function(t){window.location.href=t||""},run:function(t){var e;for(e in dry.apps)dry.apps[e].router.run(t)}},dry.settings={DEFAULT_CONTROLLER_NAME:"default",DEFAULT_CONTROLLER_METHOD:"default",AJAX_TIMEOUT:1e4,ENOXHR:1,ETIMEOUT:2},dry.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)},dry.isObject=function(t){return t===Object(t)&&!dry.isFunction(t)},dry.isStrictlyObject=function(t){return dry.isObject(t)&&!dry.isArray(t)},dry.isBoolean=function(t){return t===!0||t===!1},dry.isString=function(t){return"[object String]"===Object.prototype.toString.call(t)},dry.isFunction=function(t){return"[object Function]"===Object.prototype.toString.call(t)},dry.isUndefined=function(t){return"undefined"==typeof t},dry.isNumeric=function(t){return!isNaN(parseFloat(t))&&isFinite(t)},dry.keys=function(t){var e,n=[];for(e in t)t.hasOwnProperty(e)&&n.push(e);return n},dry.each=function(t,e,n){var r,i,o;if(dry.isStrictlyObject(t))for(o=dry.keys(t),r=0,i=o.length;i>r;r++)e.call(n,t[o[r]],o[r],t);else for(r=0,i=t.length;i>r;r++)e.call(n,t[r],r,t)},dry.jsonp=function(t,e){var n="dry_jsonp_callback_"+Math.round(1e5*Math.random());window[n]=function(t){delete window[n],document.body.removeChild(r),e(t)};var r=document.createElement("script");r.src=t+(t.indexOf("?")>=0?"&":"?")+"callback="+n,document.body.appendChild(r)},dry.Promise=function(){this._callbacks=[]},dry.Promise.prototype.then=function(t,e){var n,r;return this._isdone?n=t.apply(e,this.result):(n=new dry.Promise,this._callbacks.push(function(){r=t.apply(e,arguments),r&&dry.isFunction(r.then)&&r.then(n.done,n)})),n},dry.Promise.prototype.done=function(){var t,e;for(this.result=arguments,this._isdone=!0,t=0,e=this._callbacks.length;e>t;t++)this._callbacks[t].apply(null,arguments);this._callbacks=[]},dry.Promise.join=function(t){function e(t){return function(){s+=1,o[t]=Array.prototype.slice.call(arguments),s===n&&i.done(o)}}var n,r,i=new dry.Promise,o=[],s=0;if(!t||!t.length)return i.done(o),i;for(n=t.length,r=0;n>r;r++)t[r].then(e(r));return i},dry.Promise.chain=function(t,e){var n=new dry.Promise;return 0===t.length?n.done.apply(n,e):t[0].apply(null,e).then(function(){t.splice(0,1),dry.Promise.chain(t,arguments).then(function(){n.done.apply(n,arguments)})}),n},dry.ajax=function(t,e,n,r){n=n||{},r=r||{};var i,o,s,d,a,c=new dry.Promise,l=function(){var t;if(window.XMLHttpRequest)t=new XMLHttpRequest;else if(window.ActiveXObject)try{t=new ActiveXObject("Msxml2.XMLHTTP")}catch(e){t=new ActiveXObject("Microsoft.XMLHTTP")}return t},u=function(t){var e="";if(dry.isString(t))e=t;else{var n=encodeURIComponent;for(var r in t)t.hasOwnProperty(r)&&(e+="&"+n(r)+"="+n(t[r]))}return e},p=function(){i.abort(),c.done(dry.settings.ETIMEOUT,"",i)};try{i=l()}catch(y){return c.done(dry.settings.ENOXHR,""),c}o=u(n),"GET"===t&&o&&(e+="?"+o,o=null),i.open(t,e),i.setRequestHeader("Content-type","application/x-www-form-urlencoded");for(s in r)r.hasOwnProperty(s)&&i.setRequestHeader(s,r[s]);return d=dry.settings.AJAX_TIMEOUT,d&&(a=setTimeout(p,d)),i.onreadystatechange=function(){var t;d&&clearTimeout(a),4===i.readyState&&(t=!i.status||(i.status<200||i.status>=300)&&304!==i.status,c.done(t,i.responseText,i))},i.send(o),c},dry.each(["GET","POST","PUT","DELETE"],function(t){dry[t.toLowerCase()]=function(e,n,r){return dry.ajax(t,e,n,r)}}),dry.Dom=function(t){this.element=document.querySelector(t)},dry.Dom.prototype.html=function(t){return t?(this.element.innerHTML=t,this):this.element.innerHTML},dry.Dom.prototype.on=function(t,e){this.element.addEventListener(t,e)},dry.Dom.prototype.off=function(t,e){this.element.removeEventListener(t,e)},dry.Dom.prototype.trigger=function(t,e){var n;window.CustomEvent?n=new CustomEvent(t,{detail:e}):(n=document.createEvent("CustomEvent"),n.initCustomEvent(t,!0,!0,e)),this.element.dispatchEvent(n)},dry.App=function(t,e){this.name=t,this.options=e||{},this.routes=this.options.routes||[],this.filters=this.options.filters||{},this.controllers=this.options.controllers||{},this.views=this.options.views||{},this.modelDefinitions=this.options.models||{}},dry.App.prototype.controller=function(t,e){var n,r=this;return dry.isUndefined(e)?n=this.controllers[t]:(n=new dry.Controller(t,e),this.controllers[t]=n,dry.each(e,function(e,n){n.toLowerCase()===dry.settings.DEFAULT_CONTROLLER_METHOD?r.routes.push(t):r.routes.push(t+"/"+n)})),n},dry.App.prototype.redirect=function(t,e,n){this.controllers[t].invokeMethod(e,n)},dry.App.prototype.filter=function(t,e,n){return dry.isUndefined(e)&&dry.isUndefined(n)?this.views[t]:(this.filters[t]=new dry.Filter(t,e,n),void 0)},dry.App.prototype.view=function(t,e){return dry.isUndefined(e)?this.views[t]:(this.views[t]=new dry.View(t,e),void 0)},dry.App.prototype.init=function(){this.router=new dry.Router(this.name,this.routes),this.router.init()},dry.App.prototype.model=function(t,e){return e?(this.modelDefinitions[t]=e,void 0):new dry.Model(t,this.modelDefinitions[t])},dry.Router=function(t,e){this.rules={};var n,r,i,o=this,s=function(t){var e=t.url.split("/"),n=e[0]||dry.settings.DEFAULT_CONTROLLER_NAME,r=e[1]?e[1].split("?")[0]:dry.settings.DEFAULT_CONTROLLER_METHOD,i=dry.apps[o.appName].controllers[n];i.invokeMethod(r,t.params)};for(this.appName=t,e.indexOf(dry.settings.DEFAULT_CONTROLLER_NAME)>-1&&e.push(""),n=0,r=e.length;r>n;n++)i=e[n],this.add(i,s)},dry.Router.prototype.add=function(t,e){for(var n=t.split("/"),r=this.rules,i=0;i<n.length;++i){var o=n[i],s=o.length&&":"==o.charAt(0)?":":o;r[s]?r=r[s]:(r=r[s]={},":"==s&&(r["@name"]=o.slice(1)))}r["@"]=e},dry.Router.prototype.run=function(t){t&&t.length&&(t=t.replace("/?","?"),"/"==t.charAt(0)&&(t=t.slice(1)),t.length&&"/"==t.slice(-1)&&(t=t.slice(0,-1)));var e=this.rules,n=t.split("?",2),r=n[0].split("/",50),i={};return function(){for(var t=0;t<r.length&&e;++t){var n=r[t],o=e[n.toLowerCase()];!o&&(o=e[":"])&&(i[o["@name"]]=n),e=o}}(),function(t){for(var e=t.split("&",50),n=0;n<e.length;++n){var r=e[n].split("=",2);2==r.length&&(i[r[0]]=r[1])}}(2==n.length?n[1]:""),e&&e["@"]?(e["@"]({url:t,params:i}),!0):!1},dry.Router.prototype.init=function(){var t=this,e=function(){var e=location.hash||"#";t.run(e.substr(1))};window.addEventListener("hashchange",e),e()},dry.Model=function(t,e){e=e||{},this.name=t,this.attributes=e.attributes||{},this.validations=[];var n=this;dry.each(e,function(t,e){var r,i,o;dry.isString(t)&&(r=t.split(" "),i=r[0],o=r[1],n[e]=n.endpointMethod(i,o))})},dry.Model.prototype.endpointMethod=function(t,e){return function(n,r,i){var o,s,d=e,a=this.attributes;for(o in a)d=d.replace("{"+o+"}",a[o]);for(s in n)d=d.replace("{"+s+"}",n[s]);return dry.ajax({url:d,type:t,data:n,success:r,error:i})}},dry.Model.prototype.set=function(t,e){var n=dry.isStrictlyObject(t)?t:{name:e},r=this;dry.each(n,function(t,e){r.attributes[e]=t})},dry.Model.prototype.get=function(t){return this.attributes[t]},dry.Model.prototype.validate=function(t,e){this.validations[t].push(e)},dry.Model.prototype.isValid=function(t){for(var e,n,r=[t]||dry.keys(this.attributes),i=0,o=0,s=r.length,d=!0;d&&s>i;){for(o=0,n=this.validations[r[i]],e=n.length;d&&e>o;)d=n[o].apply(this),o++;i++}return d||i},dry.Filter=function(t,e,n){this.name=t,this.condition=e,this.action=n},dry.Filter.prototype.runFilter=function(){var t=this.condition();return t&&this.action&&this.action(),t},dry.Controller=function(t,e){this.name=t,this.methods=e||{}},dry.Controller.prototype.invokeMethod=function(t,e){var n,r,i=this.methods[t];i?n=i.call(this,e):(r=this.name,t&&t!=dry.settings.DEFAULT_CONTROLLER_METHOD&&(r+="/"+t),n=new dry.View(r,{templateData:e,controller:this})),n&&n.constructor===dry.View&&(n.controller=n.controller||this,n.render())},dry.Controller.prototype.redirect=function(t,e){this.invokeMethod(t,e)},dry.Template=function(t,e){this.name=t,dry.isFunction(e)?this.compile=e:this.templateId=e||'script[data-dry="'+t+'"]'},dry.Template.prototype.cache=[],dry.Template.prototype.compile=function(t){var e=this.cache[this.name]||dry.$(this.templateId).element.innerHTML,n=new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+e.replace(/[\r\t\n]/g," ").split("<%").join("	").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("	").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}return p.join('');");return n(t.attributes)},dry.View=function(t,e){e=e||{},this.name=t,this.el=e.el||':not(script)[data-dry="'+t+'"]',this.model=e.model||new dry.Model(t),this.template=new dry.Template(t,e.template),this.controller=e.controller,this.events=e.events||{}},dry.View.prototype.render=function(){var t=dry.$(this.el),e=this.template.compile(this.model),n=this.events,r=this;t.html(e),dry.each(n,function(t,e){r.addEvent(e,t)})},dry.View.prototype.addEvent=function(t,e){var n,r,i;n=t.split(" "),r=n[1],i=n[0],dry.isString(e)&&(e=function(t){this.controller.invokeMethod(e,t)}),dry.$(r).on(i,e)};