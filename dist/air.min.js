function Rlite(){this.rules={}}air={$:function(t){return new air.Dom(t)},apps:{},app:function(t,e){return this.apps[t]||(this.apps[t]=new air.App(t,e))},navigate:function(t){window.location.href=t||""},run:function(t){var e;for(e in air.apps)air.apps[e].router.run(t)}},air.settings={DEFAULT_CONTROLLER_NAME:"default",DEFAULT_CONTROLLER_METHOD:"default"},air.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)},air.isObject=function(t){return t===Object(t)&&!air.isFunction(t)},air.isStrictlyObject=function(t){return air.isObject(t)&&!air.isArray(t)},air.isBoolean=function(t){return t===!0||t===!1},air.isString=function(t){return"[object String]"===Object.prototype.toString.call(t)},air.isFunction=function(t){return"[object Function]"===Object.prototype.toString.call(t)},air.isUndefined=function(t){return"undefined"==typeof t},air.isNumeric=function(t){return!isNaN(parseFloat(t))&&isFinite(t)},air.keys=function(t){var e,i=[];for(e in t)t.hasOwnProperty(e)&&i.push(e);return i},air.each=function(t,e,i){var r,n,o;if(air.isStrictlyObject(t))for(o=air.keys(t),r=0,n=o.length;n>r;r++)e.call(i,t[o[r]],o[r],t);else for(r=0,n=t.length;n>r;r++)e.call(i,t[r],r,t)},air.ajax=function(t){var e,i=t.type||"GET",r=i.toUpperCase()||"GET",n=new XMLHttpRequest;return n.open(r,t.url,!0),n.onreadystatechange=function(){if(4===this.readyState)if(this.status>=200&&this.status<400&&t.success)try{e=JSON.parse(this.responseText),t.success(e)}catch(i){t.success(this.responseText)}else t.error&&t.error(this)},n.timeout=t.timeout||1e4,n.ontimeout=t.ontimeout||function(){console.error("air.ajax timeout for url",t.url)},"GET"===r?n.send():r&&(n.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),n.send(air.param(t.data))),n=null,this},air.getJSON=function(t,e,i){return air.ajax({type:"GET",url:t,success:function(t){e&&e(JSON.parse(t))},error:i})},air.get=function(t,e,i){return air.ajax({type:"GET",url:t,success:e,error:i})},air.each(["post","put","delete"],function(t){air[t]=function(e,i,r,n){return air.ajax({type:t,url:e,data:i,success:r,error:n})}}),air.jsonp=function(t,e){var i="air_jsonp_callback_"+Math.round(1e5*Math.random());window[i]=function(t){delete window[i],document.body.removeChild(r),e(t)};var r=document.createElement("script");r.src=t+(t.indexOf("?")>=0?"&":"?")+"callback="+i,document.body.appendChild(r)},air.param=function(t){var e,i=/%20/g,r=/\[\]$/,n=[],o=function(t,e){e=air.isFunction(e)?e():null==e?"":e,n[n.length]=encodeURIComponent(t)+"="+encodeURIComponent(e)},a=function(t,e,i){var n;if(air.isArray(e))air.each(e,function(e,n){r.test(t)?i(t,e):a(t+"["+("object"==typeof e?n:"")+"]",e,i)});else if(air.isObject(e))for(n in e)a(t+"["+n+"]",e[n],i);else i(t,e)};if(air.isArray(t)||!air.isStrictlyObject(t))air.each(t,function(){o(this.name,this.value)});else for(e in t)a(e,t[e],o);return n.join("&").replace(i,"+")},air.Dom=function(t){this.element=document.querySelector(t)},air.Dom.prototype.html=function(t){return t?(this.element.innerHTML=t,this):this.element.innerHTML},air.Dom.prototype.on=function(t,e){this.element.addEventListener(t,e)},air.Dom.prototype.off=function(t,e){this.element.removeEventListener(t,e)},air.Dom.prototype.trigger=function(t,e){var i;window.CustomEvent?i=new CustomEvent(t,{detail:e}):(i=document.createEvent("CustomEvent"),i.initCustomEvent(t,!0,!0,e)),this.element.dispatchEvent(i)},air.App=function(t,e){this.name=t,this.options=e||{},this.routes=this.options.routes||[],this.controllers=this.options.controllers||{},this.views=this.options.views||{},this.modelDefinitions=this.options.models||{}},air.App.prototype.controller=function(t,e){var i,r=this;return air.isUndefined(e)?i=this.controllers[t]:(i=new air.Controller(t,e),this.controllers[t]=i,air.each(e,function(e,i){r.routes.push(i.toLowerCase()===air.settings.DEFAULT_CONTROLLER_METHOD?t:t+"/"+i)})),i},air.App.prototype.view=function(t,e){return air.isUndefined(e)?this.views[t]:void(this.views[t]=new air.View(t,e))},air.App.prototype.init=function(){this.router=new air.Router(this.name,this.routes),this.router.init()},air.App.prototype.model=function(t,e){return e?void(this.modelDefinitions[t]=e):new air.Model(t,this.modelDefinitions[t])},air.Router=function(t,e){var i,r,n,o=this,a=function(t){var e=t.url.split("/"),i=e[0]||air.settings.DEFAULT_CONTROLLER_NAME,r=e[1]?e[1].split("?")[0]:air.settings.DEFAULT_CONTROLLER_METHOD,n=air.apps[o.appName].controllers[i];n.invokeMethod(r,t.params)};for(this.appName=t,this.r||(this.rlite=new Rlite),e.indexOf(air.settings.DEFAULT_CONTROLLER_NAME)>-1&&e.push(""),i=0,r=e.length;r>i;i++)n=e[i],this.rlite.add(n,a)},air.Router.prototype.run=function(t){this.rlite.run(t)},air.Router.prototype.init=function(){var t=this,e=function(){var e=location.hash||"#";t.rlite.run(e.substr(1))};window.addEventListener("hashchange",e),e()},air.Model=function(t,e){e=e||{},this.name=t,this.attributes=e.attributes||{};var i=this;air.each(e,function(t,e){var r,n,o;air.isString(t)&&(r=t.split(" "),n=r[0],o=r[1],i[e]=i.endpointMethod(n,o))})},air.Model.prototype.endpointMethod=function(t,e){return function(i,r,n){var o,a,s=e,u=this.attributes;for(o in u)s=s.replace("{"+o+"}",u[o]);for(a in i)s=s.replace("{"+a+"}",i[a]);return air.ajax({url:s,type:t,data:i,success:r,error:n})}},air.Controller=function(t,e){this.name=t,this.methods=e||{}},air.Controller.prototype.invokeMethod=function(t,e){var i,r,n=this.methods[t];n?i=n.call(this,e):(r=this.name,t&&t!=air.settings.DEFAULT_CONTROLLER_METHOD&&(r+="/"+t),i=new air.View(r,{templateData:e,controller:this})),i&&i.constructor===air.View&&(i.controller=i.controller||this,i.render())},air.Template=function(t,e){this.name=t,air.isFunction(e)?this.compile=e:this.templateId=e||'script[data-air="'+t+'"]'},air.Template.prototype.cache=[],air.Template.prototype.compile=function(t){var e=this.cache[this.name]||air.$(this.templateId).element.innerHTML,i=new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+e.replace(/[\r\t\n]/g," ").split("<%").join("	").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("	").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}return p.join('');");return i(t.attributes)},air.View=function(t,e){e=e||{},this.name=t,this.el=e.el||':not(script)[data-air="'+t+'"]',this.model=e.model||new air.Model(t),this.template=new air.Template(t,e.template),this.controller=e.controller,this.events=e.events||{}},air.View.prototype.render=function(){var t=air.$(this.el),e=this.template.compile(this.model),i=this.events,r=this;t.html(e),air.each(i,function(t,e){r.addEvent(e,t)})},air.View.prototype.addEvent=function(t,e){var i,r,n;i=t.split(" "),r=i[1],n=i[0],air.isString(e)&&(e=function(t){this.controller.invokeMethod(e,t)}),air.$(r).on(n,e)},Rlite.prototype={add:function(t,e){for(var i,r,n=t.split("/"),o=this.rules,a=0;a<n.length;++a)i=n[a],r=i.length&&":"==i.charAt(0)?":":i,o[r]?o=o[r]:(o=o[r]={},":"==r&&(o["@name"]=i.substr(1,i.length-1)));o["@"]=e},run:function(t){t&&t.length&&(t=t.replace("/?","?"),"/"==t.charAt(0)&&(t=t.substr(1,t.length)),t.length&&"/"==t.charAt(t.length-1)&&(t=t.substr(0,t.length-1)));var e=this.rules,i=t.split("?",2),r=i[0].split("/",50),n={};return function(){for(var t=0;t<r.length&&e;++t){var i=r[t],o=i.toLowerCase(),a=e[o];!a&&(a=e[":"])&&(n[a["@name"]]=i),e=a}}(),function(t){for(var e,i=t.split("&",50),r=0;r<i.length;++r)e=i[r].split("=",2),2==e.length&&(n[e[0]]=e[1])}(2==i.length?i[1]:""),e&&e["@"]?(e["@"]({url:t,params:n}),!0):!1}};