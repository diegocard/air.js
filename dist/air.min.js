function Rlite(){this.rules={}}air={$:function(t){return new air.Dom(t)},apps:{},app:function(t,e){var i=this.apps[t];return i||(i=new air.App(t,e),this.apps[t]=i),i},navigate:function(t){t=t||"",window.location.href=t},run:function(t){var e;for(e in air.apps)air.apps[e].router.run(t)}},air.settings={DEFAULT_CONTROLLER_NAME:"default",DEFAULT_CONTROLLER_METHOD:"default"},air.Dom=function(t){this.element=document.querySelector(t)},air.Dom.prototype.html=function(t){return t?(this.element.innerHTML=t,this):this.element.innerHTML},air.Dom.prototype.on=function(t,e){this.element.addEventListener(t,e)},air.Dom.prototype.off=function(t,e){this.element.removeEventListener(t,e)},air.Dom.prototype.trigger=function(t,e){var i;window.CustomEvent?i=new CustomEvent(t,{detail:e}):(i=document.createEvent("CustomEvent"),i.initCustomEvent(t,!0,!0,e)),el.dispatchEvent(i)},air.App=function(t,e){this.name=t,this.options=e||{},this.routes=this.options.routes||[],this.controllers=this.options.controllers||{},this.views=this.options.views||{}},air.App.prototype.controller=function(t,e){var i,n;if(air.isUndefined(e))i=this.controllers[t];else{i=new air.Controller(t,e),this.controllers[t]=i;for(n in e)e.hasOwnProperty(n)&&this.routes.push(n.toLowerCase()===air.settings.DEFAULT_CONTROLLER_METHOD?t:t+"/"+n)}return i},air.App.prototype.view=function(t,e){return air.isUndefined(e)?this.views[t]:void(this.views[t]=new air.View(t,e))},air.App.prototype.init=function(){this.router=new air.Router(this.name,this.routes),this.router.init()},air.Router=function(t,e){var i,n,r,o=this,s=function(t){var e=t.url.split("/"),i=e[0]||air.settings.DEFAULT_CONTROLLER_NAME,n=e[1]?e[1].split("?")[0]:air.settings.DEFAULT_CONTROLLER_METHOD,r=air.apps[o.appName].controllers[i];r.invokeMethod(n,t.params)};for(this.appName=t,this.r||(this.rlite=new Rlite),e.indexOf(air.settings.DEFAULT_CONTROLLER_NAME)>-1&&e.push(""),i=0,n=e.length;n>i;i++)r=e[i],this.rlite.add(r,s)},air.Router.prototype.run=function(t){this.rlite.run(t)},air.Router.prototype.init=function(){var t=this,e=function(){var e=location.hash||"#";t.rlite.run(e.substr(1))};window.addEventListener("hashchange",e),e()},air.Model=function(t,e){e=e||{},this.name=t,this.data=e},air.Controller=function(t,e){this.name=t,this.methods=e||{}},air.Controller.prototype.invokeMethod=function(t,e){var i,n,r,o=this.methods[t];o?(i=o.apply(this,e),typeof i===air.View&&(r=i)):(n=this.name,t&&t!=air.settings.DEFAULT_CONTROLLER_METHOD&&(n+="/"+t),r=new air.View(n,{templateData:e,controller:this})),r.controller||(r.controller=this),r.render()},air.Template=function(t,e){this.name=t,air.isFunction(e)?this.compile=e:this.templateId=e||'script[data-air="'+t+'"]'},air.Template.prototype.cache=[],air.Template.prototype.compile=function(t){var e=this.cache[this.name]||air.$(this.templateId).element.innerHTML,i=new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+e.replace(/[\r\t\n]/g," ").split("<%").join("	").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("	").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}return p.join('');");return i(t.data)},air.View=function(t,e){e=e||{},this.name=t,this.el=e.el||':not(script)[data-air="'+t+'"]',this.model=e.model||new air.Model(t),this.template=new air.Template(t,e.template),this.controller=e.controller,this.events=e.events||{}},air.View.prototype.render=function(){var t,e,i,n,r,o=air.$(this.el),s=this.template.compile(this.model),a=this.events;o.html(s);for(t in a)a.hasOwnProperty(t)&&(e=t.split(" "),i=e[1],n=e[0],r=a[t],air.$(i).on(n,r))},Rlite.prototype={add:function(t,e){for(var i,n,r=t.split("/"),o=this.rules,s=0;s<r.length;++s)i=r[s],n=i.length&&":"==i.charAt(0)?":":i,o[n]?o=o[n]:(o=o[n]={},":"==n&&(o["@name"]=i.substr(1,i.length-1)));o["@"]=e},run:function(t){t&&t.length&&(t=t.replace("/?","?"),"/"==t.charAt(0)&&(t=t.substr(1,t.length)),t.length&&"/"==t.charAt(t.length-1)&&(t=t.substr(0,t.length-1)));var e=this.rules,i=t.split("?",2),n=i[0].split("/",50),r={};return function(){for(var t=0;t<n.length&&e;++t){var i=n[t],o=i.toLowerCase(),s=e[o];!s&&(s=e[":"])&&(r[s["@name"]]=i),e=s}}(),function(t){for(var e,i=t.split("&",50),n=0;n<i.length;++n)e=i[n].split("=",2),2==e.length&&(r[e[0]]=e[1])}(2==i.length?i[1]:""),e&&e["@"]?(e["@"]({url:t,params:r}),!0):!1}};