<!DOCTYPE html>

<html>
<head>
  <title>dry.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>dry.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <h2 id="dry-js">DRY.JS</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre>
dry = {</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>jQuery-like function</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    $: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(element)</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> dry.Dom(element);
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>Apps container</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    apps: {},</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Returns an app or create it if it doesn’t exist (Singleton)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    app: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(name, options)</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.apps[name] || (<span class="hljs-keyword">this</span>.apps[name] = <span class="hljs-keyword">new</span> dry.App(name, options));
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>Navigate to a certain url</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    navigate: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(url)</span> </span>{
        <span class="hljs-built_in">window</span>.location.href = url || <span class="hljs-string">''</span>;
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>Exexute a route without navigating</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    run: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(route)</span> </span>{
        <span class="hljs-keyword">var</span> app;
        <span class="hljs-keyword">for</span> (app <span class="hljs-keyword">in</span> dry.apps) {
            dry.apps[app].router.run(route);
        }
    }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <h2 id="settings">Settings</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre>dry.settings = {</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>When a route is left empty, the router will look for this controller</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    DEFAULT_CONTROLLER_NAME: <span class="hljs-string">"default"</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>When a route doesn’t target any specific method, it will look for this one</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    DEFAULT_CONTROLLER_METHOD: <span class="hljs-string">"default"</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>Time in milliseconds after which apending AJAX request is considered unresponsive and is aborted.
Useful to deal with bad connectivity (e.g. on a mobile network).
A 0 value disables AJAX timeouts.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    AJAX_TIMEOUT: <span class="hljs-number">10000</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>Error returned on promises when XHR is not implemented in the current browser</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    ENOXHR: <span class="hljs-number">1</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>Error returned on promises when an Ajax call is timed out</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    ETIMEOUT: <span class="hljs-number">2</span>
};</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <h2 id="utilities">Utilities</h2>

            </div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>Check if the given parameter is an array</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>dry.isArray = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(arr)</span> </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">Object</span>.prototype.toString.call(arr) === <span class="hljs-string">"[object Array]"</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>Check if the given parameter is an object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>dry.isObject = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(obj)</span> </span>{
    <span class="hljs-keyword">return</span> obj === <span class="hljs-built_in">Object</span>(obj) &amp;&amp; !dry.isFunction(obj);
};</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>Check if the given parameter is strictly an object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>dry.isStrictlyObject = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(obj)</span> </span>{
    <span class="hljs-keyword">return</span> dry.isObject(obj) &amp;&amp; !dry.isArray(obj);
};</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>Check if the given parameter is boolean</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>dry.isBoolean = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(bool)</span> </span>{
    <span class="hljs-keyword">return</span> bool === <span class="hljs-literal">true</span> || bool === <span class="hljs-literal">false</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>Check if the given parameter is a string</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>dry.isString = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(str)</span> </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">Object</span>.prototype.toString.call(str) === <span class="hljs-string">"[object String]"</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>Check if the given parameter is a function</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>dry.isFunction = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(fun)</span> </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">Object</span>.prototype.toString.call(fun) === <span class="hljs-string">"[object Function]"</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>Check if the given parameter is undefined</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>dry.isUndefined = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(obj)</span> </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">typeof</span> obj === <span class="hljs-string">"undefined"</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>Check if the given parameter is numeric</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>dry.isNumeric = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(num)</span> </span>{
    <span class="hljs-keyword">return</span> !<span class="hljs-built_in">isNaN</span>(<span class="hljs-built_in">parseFloat</span>(num)) &amp;&amp; <span class="hljs-built_in">isFinite</span>(num);
};</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>Returns an array with the property names for the given object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>dry.keys = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(obj)</span> </span>{
    <span class="hljs-keyword">var</span> keys = [],
        key;
    <span class="hljs-keyword">for</span> (key <span class="hljs-keyword">in</span> obj) {
        <span class="hljs-keyword">if</span> (obj.hasOwnProperty(key)) {
            keys.push(key);
        }
    }
    <span class="hljs-keyword">return</span> keys;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>Concise and efficient forEach implementation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>dry.each = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(obj, func, context)</span> </span>{
    <span class="hljs-keyword">var</span> i, len, keys;
    <span class="hljs-keyword">if</span> (dry.isStrictlyObject(obj)) {
        keys = dry.keys(obj);
        <span class="hljs-keyword">for</span> (i=<span class="hljs-number">0</span>, len=keys.length; i&lt;len; i++) {
            func.call(context, obj[keys[i]], keys[i], obj);
        }
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">for</span> (i=<span class="hljs-number">0</span>, len=obj.length; i&lt;len; i++) {
            func.call(context, obj[i], i, obj);
        }
    }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>JSONP requests</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>dry.jsonp = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(url, callback)</span> </span>{
    <span class="hljs-keyword">var</span> callbackName = <span class="hljs-string">'dry_jsonp_callback_'</span> + <span class="hljs-built_in">Math</span>.round(<span class="hljs-number">100000</span> * <span class="hljs-built_in">Math</span>.random());
    <span class="hljs-built_in">window</span>[callbackName] = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(data)</span> </span>{
        <span class="hljs-keyword">delete</span> <span class="hljs-built_in">window</span>[callbackName];
        <span class="hljs-built_in">document</span>.body.removeChild(script);
        callback(data);
    };

    <span class="hljs-keyword">var</span> script = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'script'</span>);
    script.src = url + (url.indexOf(<span class="hljs-string">'?'</span>) &gt;= <span class="hljs-number">0</span> ? <span class="hljs-string">'&amp;'</span> : <span class="hljs-string">'?'</span>) + <span class="hljs-string">'callback='</span> + callbackName;
    <span class="hljs-built_in">document</span>.body.appendChild(script);
};</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>Promises</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>dry.Promise = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">this</span>._callbacks = [];
};

dry.promise = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> dry.Promise();
};

dry.Promise.prototype.then = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(func, context)</span> </span>{
    <span class="hljs-keyword">var</span> p;
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._isdone) {
        p = func.apply(context, <span class="hljs-keyword">this</span>.result);
    } <span class="hljs-keyword">else</span> {
        p = <span class="hljs-keyword">new</span> dry.Promise();
        <span class="hljs-keyword">this</span>._callbacks.push(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
            <span class="hljs-keyword">var</span> res = func.apply(context, <span class="hljs-built_in">arguments</span>);
            <span class="hljs-keyword">if</span> (res &amp;&amp; dry.isFunction(res.then)) {
                res.then(p.done, p);
            }
        });
    }
    <span class="hljs-keyword">return</span> p;
};

dry.Promise.prototype.done = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">var</span> i, len;
    <span class="hljs-keyword">this</span>.result = <span class="hljs-built_in">arguments</span>;
    <span class="hljs-keyword">this</span>._isdone = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">for</span> (i=<span class="hljs-number">0</span>, len=<span class="hljs-keyword">this</span>._callbacks.length; i&lt;len; i++) {
        <span class="hljs-keyword">this</span>._callbacks[i].apply(<span class="hljs-literal">null</span>, <span class="hljs-built_in">arguments</span>);
    }
    <span class="hljs-keyword">this</span>._callbacks = [];
};

dry.Promise.join = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(promises)</span> </span>{
    <span class="hljs-keyword">var</span> p = <span class="hljs-keyword">new</span> dry.Promise(),
        results = [],
        numdone = <span class="hljs-number">0</span>,
        total, i;

    <span class="hljs-keyword">if</span> (!promises || !promises.length) {
        p.done(results);
        <span class="hljs-keyword">return</span> p;
    }

    total = promises.length;

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">notifier</span><span class="hljs-params">(i)</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
            numdone += <span class="hljs-number">1</span>;
            results[i] = <span class="hljs-built_in">Array</span>.prototype.slice.call(<span class="hljs-built_in">arguments</span>);
            <span class="hljs-keyword">if</span> (numdone === total) {
                p.done(results);
            }
        };
    }

    <span class="hljs-keyword">for</span> (i=<span class="hljs-number">0</span>; i&lt;total; i++) {
        promises[i].then(notifier(i));
    }

    <span class="hljs-keyword">return</span> p;
};

dry.Promise.chain = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(funcs, args)</span> </span>{
    <span class="hljs-keyword">var</span> p = <span class="hljs-keyword">new</span> dry.Promise();
    <span class="hljs-keyword">if</span> (funcs.length === <span class="hljs-number">0</span>) {
        p.done.apply(p, args);
    } <span class="hljs-keyword">else</span> {
        funcs[<span class="hljs-number">0</span>].apply(<span class="hljs-literal">null</span>, args).then(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
            funcs.splice(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>);
            dry.Promise.chain(funcs, <span class="hljs-built_in">arguments</span>).then(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
                p.done.apply(p, <span class="hljs-built_in">arguments</span>);
            });
        });
    }
    <span class="hljs-keyword">return</span> p;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>Ajax methods</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>dry.ajax = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(options)</span> </span>{
    <span class="hljs-keyword">var</span> method = options.method || <span class="hljs-string">'GET'</span>,
        data = options.data || {},
        headers = options.headers || {},
        url = options.url;

    <span class="hljs-keyword">var</span> p = <span class="hljs-keyword">new</span> dry.Promise(),
        xhr,
        newXhr = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
            <span class="hljs-keyword">var</span> xhr;
            <span class="hljs-keyword">if</span> (<span class="hljs-built_in">window</span>.XMLHttpRequest) {
                xhr = <span class="hljs-keyword">new</span> XMLHttpRequest();
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-built_in">window</span>.ActiveXObject) {
                <span class="hljs-keyword">try</span> {
                    xhr = <span class="hljs-keyword">new</span> ActiveXObject(<span class="hljs-string">"Msxml2.XMLHTTP"</span>);
                } <span class="hljs-keyword">catch</span> (e) {
                    xhr = <span class="hljs-keyword">new</span> ActiveXObject(<span class="hljs-string">"Microsoft.XMLHTTP"</span>);
                }
            }
            <span class="hljs-keyword">return</span> xhr;
        },
        encode = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(data)</span> </span>{
            <span class="hljs-keyword">var</span> result = <span class="hljs-string">""</span>;
            <span class="hljs-keyword">if</span> (dry.isString(data)) {
                result = data;
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">var</span> e = <span class="hljs-built_in">encodeURIComponent</span>;
                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> k <span class="hljs-keyword">in</span> data) {
                    <span class="hljs-keyword">if</span> (data.hasOwnProperty(k)) {
                        result += <span class="hljs-string">'&amp;'</span> + e(k) + <span class="hljs-string">'='</span> + e(data[k]);
                    }
                }
            }
            <span class="hljs-keyword">return</span> result;
        },
        onTimeout = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
            xhr.abort();
            p.done(dry.settings.ETIMEOUT, <span class="hljs-string">""</span>, xhr);
        },
        payload, h, timeout, tid;
    
    <span class="hljs-keyword">try</span> {
        xhr = newXhr();
    } <span class="hljs-keyword">catch</span> (e) {
        p.done(dry.settings.ENOXHR, <span class="hljs-string">""</span>);
        <span class="hljs-keyword">return</span> p;
    }

    payload = encode(data);
    <span class="hljs-keyword">if</span> (method === <span class="hljs-string">'GET'</span> &amp;&amp; payload) {
        url += <span class="hljs-string">'?'</span> + payload;
        payload = <span class="hljs-literal">null</span>;
    }

    xhr.open(method, url);
    xhr.setRequestHeader(<span class="hljs-string">'Content-type'</span>, <span class="hljs-string">'application/x-www-form-urlencoded'</span>);
    <span class="hljs-keyword">for</span> (h <span class="hljs-keyword">in</span> headers) {
        <span class="hljs-keyword">if</span> (headers.hasOwnProperty(h)) {
            xhr.setRequestHeader(h, headers[h]);
        }
    }

    timeout = dry.settings.AJAX_TIMEOUT;
    <span class="hljs-keyword">if</span> (timeout) {
        tid = setTimeout(onTimeout, timeout);
    }

    xhr.onreadystatechange = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">var</span> err, res;
        <span class="hljs-keyword">if</span> (timeout) {
            clearTimeout(tid);
        }
        <span class="hljs-keyword">if</span> (xhr.readyState === <span class="hljs-number">4</span>) { 
            err = (!xhr.status ||
                    (xhr.status &lt; <span class="hljs-number">200</span> || xhr.status &gt;= <span class="hljs-number">300</span>) &amp;&amp;
                    xhr.status !== <span class="hljs-number">304</span>);
            <span class="hljs-keyword">try</span> {
                <span class="hljs-comment">/* Try to convert the output to JSON */</span>
                res = <span class="hljs-built_in">JSON</span>.parse(<span class="hljs-keyword">this</span>.responseText);
            } <span class="hljs-keyword">catch</span>(e) {
                <span class="hljs-comment">/* If it fails, return the output as-is */</span>
                res = <span class="hljs-keyword">this</span>.responseText;
            }
            p.done(err, res, xhr);
        }
    };

    xhr.send(payload);
    <span class="hljs-keyword">return</span> p;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>Utility ajax method shortcuts for POST, PUT and DELETE requests</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>dry.each([<span class="hljs-string">'GET'</span>, <span class="hljs-string">'POST'</span>, <span class="hljs-string">'PUT'</span>, <span class="hljs-string">'DELETE'</span>], <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(method)</span></span>{
    dry[method.toLowerCase()] = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(url, data, headers)</span> </span>{
        <span class="hljs-keyword">return</span> dry.ajax({
            method: method,
            url: url,
            data: data,
            headers: headers
        });
    };
});</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <h2 id="dom-management-utilities">DOM Management Utilities</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre>
dry.Dom = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(name)</span> </span>{
    <span class="hljs-keyword">this</span>.element = <span class="hljs-built_in">document</span>.querySelector(name);
};</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>jQuery-like html function</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>dry.Dom.prototype.html = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(content)</span> </span>{
    <span class="hljs-keyword">if</span> (content) {
        <span class="hljs-keyword">this</span>.element.innerHTML = content;
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.element.innerHTML;
    }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>jQuery-like event handlers</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>dry.Dom.prototype.on = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(eventName, eventHandler)</span> </span>{
    <span class="hljs-keyword">this</span>.element.addEventListener(eventName, eventHandler);
};

dry.Dom.prototype.off = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(eventName, eventHandler)</span> </span>{
    <span class="hljs-keyword">this</span>.element.removeEventListener(eventName, eventHandler);
};

dry.Dom.prototype.trigger = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(eventName, data)</span> </span>{
    <span class="hljs-keyword">var</span> event;
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">window</span>.CustomEvent) {
        event = <span class="hljs-keyword">new</span> CustomEvent(eventName, {
            detail: data
        });
    } <span class="hljs-keyword">else</span> {
        event = <span class="hljs-built_in">document</span>.createEvent(<span class="hljs-string">'CustomEvent'</span>);
        event.initCustomEvent(eventName, <span class="hljs-literal">true</span>, <span class="hljs-literal">true</span>, data);
    }

    <span class="hljs-keyword">this</span>.element.dispatchEvent(event);
};</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <h2 id="app">App</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre>dry.App = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(name, options)</span> </span>{
    <span class="hljs-keyword">this</span>.name = name;
    <span class="hljs-keyword">this</span>.options = options || {};
    <span class="hljs-keyword">this</span>.routes = <span class="hljs-keyword">this</span>.options.routes || {};
    <span class="hljs-keyword">this</span>.router = <span class="hljs-keyword">new</span> dry.Router(<span class="hljs-keyword">this</span>.name);
    <span class="hljs-keyword">this</span>.filters = <span class="hljs-keyword">this</span>.options.filters || {};
    <span class="hljs-keyword">this</span>.controllers = <span class="hljs-keyword">this</span>.options.controllers || {};
    <span class="hljs-keyword">this</span>.views = <span class="hljs-keyword">this</span>.options.views || {};
    <span class="hljs-keyword">this</span>.modelDefinitions = <span class="hljs-keyword">this</span>.options.models || {};
};

dry.App.prototype.controller = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(name, methods)</span> </span>{
    <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>,
        controller;
    <span class="hljs-keyword">if</span> (dry.isUndefined(methods)) {
        controller = <span class="hljs-keyword">this</span>.controllers[name];
    } <span class="hljs-keyword">else</span> {
        controller = <span class="hljs-keyword">new</span> dry.Controller(name, methods);
        <span class="hljs-keyword">this</span>.controllers[name] = controller;        
        <span class="hljs-comment">/* Register the controller's routes */</span>
        dry.each(methods, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(method, methodName)</span></span>{
            self.router.addRoute(controller, methodName, method);
        });
    }
    <span class="hljs-keyword">return</span> controller;
};

dry.App.prototype.redirect = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(controller, method, params)</span> </span>{
    <span class="hljs-keyword">this</span>.controllers[controller].invokeMethod(method, params);
};

dry.App.prototype.filter = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(name, condition, action)</span> </span>{
    <span class="hljs-keyword">if</span> (dry.isUndefined(condition) &amp;&amp; dry.isUndefined(action)) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.views[name];
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">this</span>.filters[name] = <span class="hljs-keyword">new</span> dry.Filter(name, condition, action);
    }
};

dry.App.prototype.view = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(name, templateData)</span> </span>{
    <span class="hljs-keyword">if</span> (dry.isUndefined(templateData)) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.views[name];
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">this</span>.views[name] = <span class="hljs-keyword">new</span> dry.View(name, templateData);
    }
};

dry.App.prototype.init = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-comment">/* Initialize the app's router */</span>
    <span class="hljs-keyword">this</span>.router.init();
};

dry.App.prototype.model = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(name, params)</span> </span>{
    <span class="hljs-keyword">if</span> (!params) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> dry.Model(name, <span class="hljs-keyword">this</span>.modelDefinitions[name]);
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">/* Store the model definition if needed */</span>
        <span class="hljs-keyword">this</span>.modelDefinitions[name] = params;
    }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <h2 id="router">Router</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre>dry.Router = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(appName, routes)</span> </span>{
    <span class="hljs-keyword">this</span>.rules = {};
    <span class="hljs-keyword">this</span>.routes = [];
};

dry.Router.prototype.routeCallback = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(controller, methodName)</span> </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(route)</span> </span>{
        controller.invokeMethod(methodName, route.params);
    };
};</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>Register a route, composed by controller and method</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>dry.Router.prototype.addRoute = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(controller, methodName, method)</span> </span>{
    <span class="hljs-keyword">var</span> firstPart = (controller.name === dry.settings.DEFAULT_CONTROLLER_NAME ? <span class="hljs-string">''</span> : controller.name),
        secondPart = (methodName === dry.settings.DEFAULT_CONTROLLER_NAME ? <span class="hljs-string">''</span> : methodName),
        route = secondPart ? firstPart + <span class="hljs-string">'/'</span> + secondPart : firstPart;

    <span class="hljs-keyword">this</span>.routes.push(route);
    <span class="hljs-keyword">this</span>.add(route, <span class="hljs-keyword">this</span>.routeCallback(controller, methodName));
};

dry.Router.prototype.add = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(route, handler)</span> </span>{
    <span class="hljs-keyword">var</span> pieces = route.split(<span class="hljs-string">'/'</span>),
        rules = <span class="hljs-keyword">this</span>.rules;

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; pieces.length; ++i) {
        <span class="hljs-keyword">var</span> piece = pieces[i],
            name = piece.length &amp;&amp; piece.charAt(<span class="hljs-number">0</span>) == <span class="hljs-string">':'</span> ? <span class="hljs-string">':'</span> : piece;

        <span class="hljs-keyword">if</span> (!rules[name]) {
            rules = (rules[name] = {});

            <span class="hljs-keyword">if</span> (name == <span class="hljs-string">':'</span>) {
                rules[<span class="hljs-string">'@name'</span>] = piece.slice(<span class="hljs-number">1</span>);
            }
        } <span class="hljs-keyword">else</span> {
            rules = rules[name];
        }
    }

    rules[<span class="hljs-string">'@'</span>] = handler;
};

dry.Router.prototype.run = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(url)</span> </span>{
    <span class="hljs-keyword">if</span> (url &amp;&amp; url.length) {
        url = url.replace(<span class="hljs-string">'/?'</span>, <span class="hljs-string">'?'</span>);
        url.charAt(<span class="hljs-number">0</span>) == <span class="hljs-string">'/'</span> &amp;&amp; (url = url.slice(<span class="hljs-number">1</span>));
        url.length &amp;&amp; url.slice(-<span class="hljs-number">1</span>) == <span class="hljs-string">'/'</span> &amp;&amp; (url = url.slice(<span class="hljs-number">0</span>, -<span class="hljs-number">1</span>));
    }

    <span class="hljs-keyword">var</span> rules = <span class="hljs-keyword">this</span>.rules,
        querySplit = url.split(<span class="hljs-string">'?'</span>, <span class="hljs-number">2</span>),
        pieces = querySplit[<span class="hljs-number">0</span>].split(<span class="hljs-string">'/'</span>, <span class="hljs-number">50</span>),
        params = {};

    (<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">parseUrl</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; pieces.length &amp;&amp; rules; ++i) {
            <span class="hljs-keyword">var</span> piece = pieces[i],
                rule = rules[piece.toLowerCase()];

            <span class="hljs-keyword">if</span> (!rule &amp;&amp; (rule = rules[<span class="hljs-string">':'</span>])) {
                params[rule[<span class="hljs-string">'@name'</span>]] = piece;
            }

            rules = rule;
        }
    })();

    (<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">parseQuery</span><span class="hljs-params">(q)</span> </span>{
        <span class="hljs-keyword">var</span> query = q.split(<span class="hljs-string">'&amp;'</span>, <span class="hljs-number">50</span>);

        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; query.length; ++i) {
            <span class="hljs-keyword">var</span> nameValue = query[i].split(<span class="hljs-string">'='</span>, <span class="hljs-number">2</span>);

            nameValue.length == <span class="hljs-number">2</span> &amp;&amp; (params[nameValue[<span class="hljs-number">0</span>]] = nameValue[<span class="hljs-number">1</span>]);
        }
    })(querySplit.length == <span class="hljs-number">2</span> ? querySplit[<span class="hljs-number">1</span>] : <span class="hljs-string">''</span>);

    <span class="hljs-keyword">if</span> (rules &amp;&amp; rules[<span class="hljs-string">'@'</span>]) {
        rules[<span class="hljs-string">'@'</span>]({
            url: url,
            params: params
        });
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }

    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
};

dry.Router.prototype.init = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-comment">/* Hash-based routing */</span>
    <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>,
        processHash = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
            <span class="hljs-keyword">var</span> hash = location.hash || <span class="hljs-string">'#'</span>;
            self.run(hash.substr(<span class="hljs-number">1</span>));
        };

    <span class="hljs-built_in">window</span>.addEventListener(<span class="hljs-string">'hashchange'</span>, processHash);
    processHash();
};</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <h2 id="model">Model</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre>dry.Model = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(name, params)</span> </span>{
    params = params || {};
    <span class="hljs-keyword">this</span>.name = name;
    <span class="hljs-keyword">this</span>.attributes = params.attributes || {};
    <span class="hljs-keyword">this</span>.validations = [];
    <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;

    <span class="hljs-comment">/* Generate model methods for each given endpoint */</span>
    dry.each(params, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(value, property)</span></span>{
        <span class="hljs-keyword">var</span> split, httpMethod, url;
        <span class="hljs-keyword">if</span> (dry.isString(value)){
            split = value.split(<span class="hljs-string">' '</span>);
            httpMethod = split[<span class="hljs-number">0</span>];
            url = split[<span class="hljs-number">1</span>];
            self[property] = self.endpointMethod(httpMethod, url);
        }
    });
};</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>Generate a model method which will perform an ajax request
for a given endpoint</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>dry.Model.prototype.endpointMethod = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(httpMethod, url)</span> </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(params, success, error)</span> </span>{
        <span class="hljs-keyword">var</span> urlAfterReplacement = url,
            attributes = <span class="hljs-keyword">this</span>.attributes,
            attribute, param;
        <span class="hljs-comment">/* Replace attributes in URL */</span>
        <span class="hljs-keyword">for</span> (attribute <span class="hljs-keyword">in</span> attributes) {
            urlAfterReplacement = urlAfterReplacement.replace(<span class="hljs-string">'{'</span> + attribute + <span class="hljs-string">'}'</span>, attributes[attribute]);
        }
        <span class="hljs-comment">/* Replace params in URL */</span>
        <span class="hljs-keyword">for</span> (param <span class="hljs-keyword">in</span> params) {
            urlAfterReplacement = urlAfterReplacement.replace(<span class="hljs-string">'{'</span> + param + <span class="hljs-string">'}'</span>, params[param]);
        }
        <span class="hljs-keyword">return</span> dry.ajax({
            url: urlAfterReplacement,
            type: httpMethod,
            data: params,
            success: success,
            error: error
        });
    };
};</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>Set an attribute/s for the given model</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>dry.Model.prototype.set = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(name, value)</span> </span>{
    <span class="hljs-keyword">var</span> attrs = dry.isStrictlyObject(name) ? name : {name: value},
        self = <span class="hljs-keyword">this</span>;
    dry.each(attrs, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(val, attr)</span> </span>{
        self.attributes[attr] = val;
    });
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>Get an attribute of the given model
TODO: test, doc</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>dry.Model.prototype.get = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(name)</span> </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.attributes[name];
};</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <p>Register a validation function for an attribute
TODO: test, doc</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>dry.Model.prototype.validate = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(attr, func)</span> </span>{
    <span class="hljs-keyword">this</span>.validations[attr].push(func);
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p>Check if the entire model or one of its attributes is valid
TODO: test, doc</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>dry.Model.prototype.isValid = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(attr)</span> </span>{
    <span class="hljs-keyword">var</span> attributesToCheck = [attr] || dry.keys(<span class="hljs-keyword">this</span>.attributes),
        i = <span class="hljs-number">0</span>, <span class="hljs-comment">/* Attribute iterator */</span>
        j = <span class="hljs-number">0</span>, <span class="hljs-comment">/* Attribute validation iterator */</span>
        attributeCount = attributesToCheck.length,
        isValid = <span class="hljs-literal">true</span>,
        validationCount,
        currentAttrValidations;
    <span class="hljs-keyword">while</span> (isValid &amp;&amp; i&lt;attributeCount) {
        j = <span class="hljs-number">0</span>;
        currentAttrValidations = <span class="hljs-keyword">this</span>.validations[attributesToCheck[i]];
        validationCount = currentAttrValidations.length;
        <span class="hljs-keyword">while</span> (isValid &amp;&amp; j&lt;validationCount) {
            isValid = currentAttrValidations[j].apply(<span class="hljs-keyword">this</span>);
            j++;
        }
        i++;
    }
    <span class="hljs-comment">/* If an invalid attribute is found, return which one */</span>
    <span class="hljs-keyword">return</span> isValid || i;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <h2 id="filter">Filter</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre>dry.Filter = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(name, condition, action)</span> </span>{
    <span class="hljs-keyword">this</span>.name = name;
    <span class="hljs-keyword">this</span>.condition = condition;
    <span class="hljs-keyword">this</span>.action = action;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p>Evaluate the condition. If it is true, then run the action.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>dry.Filter.prototype.runFilter = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">var</span> result = <span class="hljs-keyword">this</span>.condition();
    <span class="hljs-keyword">if</span> (result &amp;&amp; <span class="hljs-keyword">this</span>.action) {
        <span class="hljs-keyword">this</span>.action();
    }
    <span class="hljs-keyword">return</span> result;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <h2 id="controller">Controller</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre>dry.Controller = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(name, methods)</span> </span>{
    <span class="hljs-keyword">this</span>.name = name;
    <span class="hljs-keyword">this</span>.methods = methods || {};
};

dry.Controller.prototype.invokeMethod = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(methodName, params)</span> </span>{
    <span class="hljs-keyword">var</span> method = <span class="hljs-keyword">this</span>.methods[methodName],
        result, defaultView, defaultViewName;
    <span class="hljs-keyword">if</span> (method) {
        <span class="hljs-comment">/* Invoke the method with the given parameters */</span>
        result = method.call(<span class="hljs-keyword">this</span>, params);
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">/* Default behavior: check for a default template and render it.
         * The default template should be called controllerName/methodName or
         * simply controllerName if methodName is the default one.
         */</span>
        defaultViewName = <span class="hljs-keyword">this</span>.name;
        <span class="hljs-keyword">if</span> (methodName &amp;&amp; methodName != dry.settings.DEFAULT_CONTROLLER_METHOD) {
            defaultViewName += <span class="hljs-string">'/'</span> + methodName;
        }
        result = <span class="hljs-keyword">new</span> dry.View(defaultViewName, {templateData: params, controller: <span class="hljs-keyword">this</span>});
    }
    <span class="hljs-comment">/* If a view was returned, render it */</span>
    <span class="hljs-keyword">if</span> (result &amp;&amp; result.constructor === dry.View) {
        <span class="hljs-comment">/* If the controller's method execution resulted in the creation of a view,
         * store this information in the view itself.
         */</span>
        result.controller = result.controller || <span class="hljs-keyword">this</span>;
        result.render();
    }
};

dry.Controller.prototype.redirect = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(methodName, params)</span> </span>{
    <span class="hljs-keyword">this</span>.invokeMethod(methodName, params);
};</pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <h2 id="template">Template</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre>dry.Template = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(name, tmpl)</span> </span>{
    <span class="hljs-keyword">this</span>.name = name;
    <span class="hljs-keyword">if</span> (dry.isFunction(tmpl)) {</pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <p>Allow for pre-compiled funcions</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">this</span>.compile = tmpl;
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">this</span>.templateId = tmpl || (<span class="hljs-string">'script[data-dry="'</span> + name + <span class="hljs-string">'"]'</span>);
    }
};

dry.Template.prototype.cache = [];

dry.Template.prototype.compile = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">compile</span><span class="hljs-params">(model)</span> </span>{
    <span class="hljs-comment">/* Figure out if we're getting a template, or if we need to
     * load the template - and be sure to cache the result.
     */</span>
    <span class="hljs-keyword">var</span> str = <span class="hljs-keyword">this</span>.cache[<span class="hljs-keyword">this</span>.name] || dry.$(<span class="hljs-keyword">this</span>.templateId).element.innerHTML,
        fn = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Function</span>(<span class="hljs-string">"obj"</span>,
            <span class="hljs-string">"var p=[],print=function(){p.push.apply(p,arguments);};"</span> +

            <span class="hljs-comment">/* Introduce the data as local variables using with(){} */</span>
            <span class="hljs-string">"with(obj){p.push('"</span> +

            <span class="hljs-comment">/* Convert the template into pure JavaScript */</span>
            str
            .replace(<span class="hljs-regexp">/[\r\t\n]/g</span>, <span class="hljs-string">" "</span>)
            .split(<span class="hljs-string">"&lt;%"</span>).join(<span class="hljs-string">"\t"</span>)
            .replace(<span class="hljs-regexp">/((^|%&gt;)[^\t]*)'/g</span>, <span class="hljs-string">"$1\r"</span>)
            .replace(<span class="hljs-regexp">/\t=(.*?)%&gt;/g</span>, <span class="hljs-string">"',$1,'"</span>)
            .split(<span class="hljs-string">"\t"</span>).join(<span class="hljs-string">"');"</span>)
            .split(<span class="hljs-string">"%&gt;"</span>).join(<span class="hljs-string">"p.push('"</span>)
            .split(<span class="hljs-string">"\r"</span>).join(<span class="hljs-string">"\\'"</span>) + <span class="hljs-string">"');}return p.join('');"</span>);

    <span class="hljs-comment">/* Provide some basic currying to the user */</span>
    <span class="hljs-keyword">return</span> fn(model.attributes);
};</pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <h2 id="view">View</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre>dry.View = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(name, options)</span> </span>{
    options = options || {};
    <span class="hljs-keyword">this</span>.name = name;
    <span class="hljs-keyword">this</span>.el = options.el || (<span class="hljs-string">':not(script)[data-dry="'</span> + name + <span class="hljs-string">'"]'</span>);
    <span class="hljs-keyword">this</span>.model = options.model || <span class="hljs-keyword">new</span> dry.Model(name);
    <span class="hljs-keyword">this</span>.template = <span class="hljs-keyword">new</span> dry.Template(name, options.template);
    <span class="hljs-keyword">this</span>.controller = options.controller;
    <span class="hljs-keyword">this</span>.events = options.events || {};
};

dry.View.prototype.render = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">var</span> viewElement = dry.$(<span class="hljs-keyword">this</span>.el),
        compiledTemplate = <span class="hljs-keyword">this</span>.template.compile(<span class="hljs-keyword">this</span>.model),
        events = <span class="hljs-keyword">this</span>.events,
        self = <span class="hljs-keyword">this</span>;
    viewElement.html(compiledTemplate);
    dry.each(events, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(action, key)</span></span>{
        self.addEvent(key, action);
    });
};

dry.View.prototype.addEvent = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(eventKey, eventAction)</span> </span>{
    <span class="hljs-keyword">var</span> eventKeySplit, eventElement, eventTrigger;
    eventKeySplit = eventKey.split(<span class="hljs-string">' '</span>);
    eventElement = eventKeySplit[<span class="hljs-number">1</span>];
    eventTrigger = eventKeySplit[<span class="hljs-number">0</span>];
    <span class="hljs-keyword">if</span> (dry.isString(eventAction)) {</pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <p>TODO: Finish, test</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        eventAction = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(params)</span> </span>{
            <span class="hljs-keyword">this</span>.controller.invokeMethod(eventAction, params);
        };
    }
    dry.$(eventElement).on(eventTrigger, eventAction);
};</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
