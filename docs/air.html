<!DOCTYPE html>

<html>
<head>
  <title>air.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>air.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <h2 id="air-js">AIR.JS</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre>
air = {</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>jQuery-like function</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    $: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(element)</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> air.Dom(element);
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>Apps container</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    apps: {},</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Returns an app or create it if it doesn’t exist (Singleton)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    app: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(name, options)</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.apps[name] || (<span class="hljs-keyword">this</span>.apps[name] = <span class="hljs-keyword">new</span> air.App(name, options));
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>Navigate to a certain url</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    navigate: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(url)</span> </span>{
        <span class="hljs-built_in">window</span>.location.href = url || <span class="hljs-string">''</span>;
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>Exexute a route without navigating</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    run: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(route)</span> </span>{
        <span class="hljs-keyword">var</span> app;
        <span class="hljs-keyword">for</span> (app <span class="hljs-keyword">in</span> air.apps) {
            air.apps[app].router.run(route);
        }
    }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <h2 id="settings">Settings</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre>air.settings = {</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>When a route is left empty, the router will look for this controller</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    DEFAULT_CONTROLLER_NAME: <span class="hljs-string">"default"</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>When a route doesn’t target any specific method, it will look for this one</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    DEFAULT_CONTROLLER_METHOD: <span class="hljs-string">"default"</span>
};</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <h2 id="utilities">Utilities</h2>

            </div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>Check if the given parameter is an array</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>air.isArray = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(arr)</span> </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">Object</span>.prototype.toString.call(arr) === <span class="hljs-string">"[object Array]"</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>Check if the given parameter is an object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>air.isObject = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(obj)</span> </span>{
    <span class="hljs-keyword">return</span> obj === <span class="hljs-built_in">Object</span>(obj) &amp;&amp; !air.isFunction(obj);
};</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>Check if the given parameter is strictly an object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>air.isStrictlyObject = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(obj)</span> </span>{
    <span class="hljs-keyword">return</span> air.isObject(obj) &amp;&amp; !air.isArray(obj);
};</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>Check if the given parameter is boolean</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>air.isBoolean = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(bool)</span> </span>{
    <span class="hljs-keyword">return</span> bool === <span class="hljs-literal">true</span> || bool === <span class="hljs-literal">false</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>Check if the given parameter is a string</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>air.isString = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(str)</span> </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">Object</span>.prototype.toString.call(str) === <span class="hljs-string">"[object String]"</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>Check if the given parameter is a function</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>air.isFunction = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(fun)</span> </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">Object</span>.prototype.toString.call(fun) === <span class="hljs-string">"[object Function]"</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>Check if the given parameter is undefined</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>air.isUndefined = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(obj)</span> </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">typeof</span> obj === <span class="hljs-string">"undefined"</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>Check if the given parameter is numeric</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>air.isNumeric = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(num)</span> </span>{
    <span class="hljs-keyword">return</span> !<span class="hljs-built_in">isNaN</span>(<span class="hljs-built_in">parseFloat</span>(num)) &amp;&amp; <span class="hljs-built_in">isFinite</span>(num);
};</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>Returns an array with the property names for the given object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>air.keys = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(obj)</span> </span>{
    <span class="hljs-keyword">var</span> keys = [],
        key;
    <span class="hljs-keyword">for</span> (key <span class="hljs-keyword">in</span> obj) {
        <span class="hljs-keyword">if</span> (obj.hasOwnProperty(key)) {
            keys.push(key);
        }
    }
    <span class="hljs-keyword">return</span> keys;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>Concise and efficient forEach implementation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>air.each = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(obj, func, context)</span> </span>{
    <span class="hljs-keyword">var</span> i, len, keys;
    <span class="hljs-keyword">if</span> (air.isStrictlyObject(obj)) {
        keys = air.keys(obj);
        <span class="hljs-keyword">for</span> (i=<span class="hljs-number">0</span>, len=keys.length; i&lt;len; i++) {
            func.call(context, obj[keys[i]], keys[i], obj);
        }
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">for</span> (i=<span class="hljs-number">0</span>, len=obj.length; i&lt;len; i++) {
            func.call(context, obj[i], i, obj);
        }
    }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>Simple jQuery-like ajax implementation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>air.ajax = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(options)</span> </span>{
    <span class="hljs-keyword">var</span> type = options.type || <span class="hljs-string">'GET'</span>,
        upperCaseType = type.toUpperCase() || <span class="hljs-string">'GET'</span>,
        xhr = <span class="hljs-keyword">new</span> XMLHttpRequest(),
        jsonResponse, encodedRequestData;
    xhr.open(upperCaseType, options.url, <span class="hljs-literal">true</span>);

    xhr.onreadystatechange = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.readyState === <span class="hljs-number">4</span>) {
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.status &gt;= <span class="hljs-number">200</span> &amp;&amp; <span class="hljs-keyword">this</span>.status &lt; <span class="hljs-number">400</span> &amp;&amp; options.success) {
                <span class="hljs-keyword">try</span> {
                    <span class="hljs-comment">/* Try to convert the output to JSON */</span>
                    jsonResponse = <span class="hljs-built_in">JSON</span>.parse(<span class="hljs-keyword">this</span>.responseText);
                    options.success(jsonResponse);
                } <span class="hljs-keyword">catch</span>(e) {
                    <span class="hljs-comment">/* If it fails, return the output as-is */</span>
                    options.success(<span class="hljs-keyword">this</span>.responseText);
                }
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (options.error) {
                options.error(<span class="hljs-keyword">this</span>);
            }
        }
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>Timeout</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    xhr.timeout = options.timeout || <span class="hljs-number">10000</span>;
    xhr.ontimeout = options.ontimeout || <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
        <span class="hljs-built_in">console</span>.error(<span class="hljs-string">'air.ajax timeout for url'</span>, options.url);
    };

    <span class="hljs-keyword">if</span> (upperCaseType === <span class="hljs-string">'GET'</span>) {
        xhr.send();
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (upperCaseType) { <span class="hljs-comment">/* POST, PUT, DELETE */</span>
        xhr.setRequestHeader(<span class="hljs-string">'Content-Type'</span>, <span class="hljs-string">'application/x-www-form-urlencoded; charset=UTF-8'</span>);
        xhr.send(air.param(options.data));
    }
    xhr = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>Send a GET request to retrieve JSON from a given URL</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>air.getJSON = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(url, callback, error)</span> </span>{
    <span class="hljs-keyword">return</span> air.ajax({
        type: <span class="hljs-string">'GET'</span>,
        url: url,
        success: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(data)</span> </span>{
            <span class="hljs-keyword">if</span> (callback) {
                callback(<span class="hljs-built_in">JSON</span>.parse(data));
            }
        },
        error: error
    });
};</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>Utility ajax method shortcut for GET requests</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>air.get = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(url, success, error)</span> </span>{
    <span class="hljs-keyword">return</span> air.ajax({
        type: <span class="hljs-string">'GET'</span>,
        url: url,
        success: success,
        error: error
    });
};</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>Utility ajax method shortcuts for POST, PUT and DELETE requests</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>air.each([<span class="hljs-string">'post'</span>, <span class="hljs-string">'put'</span>, <span class="hljs-string">'delete'</span>], <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(method)</span></span>{
    air[method] = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(url, data, success, error)</span> </span>{
        <span class="hljs-keyword">return</span> air.ajax({
            type: method,
            url: url,
            data: data,
            success: success,
            error: error
        });
    };
});</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>JSONP requests</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>air.jsonp = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(url, callback)</span> </span>{
    <span class="hljs-keyword">var</span> callbackName = <span class="hljs-string">'air_jsonp_callback_'</span> + <span class="hljs-built_in">Math</span>.round(<span class="hljs-number">100000</span> * <span class="hljs-built_in">Math</span>.random());
    <span class="hljs-built_in">window</span>[callbackName] = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(data)</span> </span>{
        <span class="hljs-keyword">delete</span> <span class="hljs-built_in">window</span>[callbackName];
        <span class="hljs-built_in">document</span>.body.removeChild(script);
        callback(data);
    };

    <span class="hljs-keyword">var</span> script = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'script'</span>);
    script.src = url + (url.indexOf(<span class="hljs-string">'?'</span>) &gt;= <span class="hljs-number">0</span> ? <span class="hljs-string">'&amp;'</span> : <span class="hljs-string">'?'</span>) + <span class="hljs-string">'callback='</span> + callbackName;
    <span class="hljs-built_in">document</span>.body.appendChild(script);
};</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>Serialize an array of form elements or a set of
key/values into a query string</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>air.param = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(obj)</span> </span>{
    <span class="hljs-keyword">var</span> r20 = <span class="hljs-regexp">/%20/g</span>,
        rbracket = <span class="hljs-regexp">/\[\]$/</span>,
        rCRLF = <span class="hljs-regexp">/\r?\n/g</span>,
        rsubmitterTypes = <span class="hljs-regexp">/^(?:submit|button|image|reset|file)$/i</span>,
        rsubmittable = <span class="hljs-regexp">/^(?:input|select|textarea|keygen)/i</span>,
        arr = [],
        prefix,
        add = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(key, value)</span> </span>{
            <span class="hljs-comment">/* If value is a function, invoke it and return its value */</span>
            value = air.isFunction(value) ? value() : (value == <span class="hljs-literal">null</span> ? <span class="hljs-string">""</span> : value);
            arr[arr.length] = <span class="hljs-built_in">encodeURIComponent</span>(key) + <span class="hljs-string">"="</span> + <span class="hljs-built_in">encodeURIComponent</span>(value);
        },
        buildParams = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(prefix, obj, add)</span> </span>{
            <span class="hljs-keyword">var</span> name;

            <span class="hljs-keyword">if</span> (air.isArray(obj)) {
                <span class="hljs-comment">/* Serialize array item */</span>
                air.each(obj, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(value, index)</span> </span>{
                    <span class="hljs-keyword">if</span> (rbracket.test(prefix)) {
                        <span class="hljs-comment">/* Treat each array item as a scalar */</span>
                        add(prefix, value);
                    } <span class="hljs-keyword">else</span> {
                        <span class="hljs-comment">/* Item is non-scalar (array or object), encode its numeric index */</span>
                        buildParams(prefix + <span class="hljs-string">"["</span> + (<span class="hljs-keyword">typeof</span> value === <span class="hljs-string">"object"</span> ? index : <span class="hljs-string">""</span>) + <span class="hljs-string">"]"</span>, value, add);
                    }
                });

            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (air.isObject(obj)) {
                <span class="hljs-comment">/* Serialize object item */</span>
                <span class="hljs-keyword">for</span> (name <span class="hljs-keyword">in</span> obj) {
                    buildParams(prefix + <span class="hljs-string">"["</span> + name + <span class="hljs-string">"]"</span>, obj[name], add);
                }
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-comment">/* Serialize scalar item */</span>
                add(prefix, obj);
            }
        };

    <span class="hljs-comment">/* If an array was passed in, assume that it is an array of form elements */</span>
    <span class="hljs-keyword">if</span> (air.isArray(obj) || (!air.isStrictlyObject(obj))) {
        <span class="hljs-comment">/* Serialize the form elements */</span>
        air.each(obj, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
            add(<span class="hljs-keyword">this</span>.name, <span class="hljs-keyword">this</span>.value);
        });
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">/* Encode params recursively */</span>
        <span class="hljs-keyword">for</span> (prefix <span class="hljs-keyword">in</span> obj) {
            buildParams(prefix, obj[prefix], add);
        }
    }

    <span class="hljs-comment">/* Return the resulting serialization */</span>
    <span class="hljs-keyword">return</span> arr.join(<span class="hljs-string">"&amp;"</span>).replace(r20, <span class="hljs-string">"+"</span>);
};</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <h2 id="dom-management-utilities">DOM Management Utilities</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre>
air.Dom = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(name)</span> </span>{
    <span class="hljs-keyword">this</span>.element = <span class="hljs-built_in">document</span>.querySelector(name);
};</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>jQuery-like html function</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>air.Dom.prototype.html = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(content)</span> </span>{
    <span class="hljs-keyword">if</span> (content) {
        <span class="hljs-keyword">this</span>.element.innerHTML = content;
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.element.innerHTML;
    }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>jQuery-like event handlers</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>air.Dom.prototype.on = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(eventName, eventHandler)</span> </span>{
    <span class="hljs-keyword">this</span>.element.addEventListener(eventName, eventHandler);
};

air.Dom.prototype.off = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(eventName, eventHandler)</span> </span>{
    <span class="hljs-keyword">this</span>.element.removeEventListener(eventName, eventHandler);
};

air.Dom.prototype.trigger = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(eventName, data)</span> </span>{
    <span class="hljs-keyword">var</span> event;
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">window</span>.CustomEvent) {
        event = <span class="hljs-keyword">new</span> CustomEvent(eventName, {
            detail: data
        });
    } <span class="hljs-keyword">else</span> {
        event = <span class="hljs-built_in">document</span>.createEvent(<span class="hljs-string">'CustomEvent'</span>);
        event.initCustomEvent(eventName, <span class="hljs-literal">true</span>, <span class="hljs-literal">true</span>, data);
    }

    el.dispatchEvent(event);
};</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <h2 id="app">App</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre>air.App = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(name, options)</span> </span>{
    <span class="hljs-keyword">this</span>.name = name;
    <span class="hljs-keyword">this</span>.options = options || {};
    <span class="hljs-keyword">this</span>.routes = <span class="hljs-keyword">this</span>.options.routes || [];
    <span class="hljs-keyword">this</span>.controllers = <span class="hljs-keyword">this</span>.options.controllers || {};
    <span class="hljs-keyword">this</span>.views = <span class="hljs-keyword">this</span>.options.views || {};
    <span class="hljs-keyword">this</span>.modelDefinitions = <span class="hljs-keyword">this</span>.options.models || {};
};

air.App.prototype.controller = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(name, methods)</span> </span>{
    <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>,
        controller;
    <span class="hljs-keyword">if</span> (air.isUndefined(methods)) {
        controller = <span class="hljs-keyword">this</span>.controllers[name];
    } <span class="hljs-keyword">else</span> {
        controller = <span class="hljs-keyword">new</span> air.Controller(name, methods);
        <span class="hljs-keyword">this</span>.controllers[name] = controller;
        <span class="hljs-comment">/* Register routes for each controller method */</span>
        air.each(methods, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(method, methodName)</span></span>{
            <span class="hljs-keyword">if</span> (methodName.toLowerCase() === air.settings.DEFAULT_CONTROLLER_METHOD) {
                self.routes.push(name);
            } <span class="hljs-keyword">else</span> {
                self.routes.push(name + <span class="hljs-string">'/'</span> + methodName);
            }
        });
    }
    <span class="hljs-keyword">return</span> controller;
};

air.App.prototype.view = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(name, templateData)</span> </span>{
    <span class="hljs-keyword">if</span> (air.isUndefined(templateData)) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.views[name];
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">this</span>.views[name] = <span class="hljs-keyword">new</span> air.View(name, templateData);
    }
};

air.App.prototype.init = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-comment">/* Create and initialize the app's router */</span>
    <span class="hljs-keyword">this</span>.router = <span class="hljs-keyword">new</span> air.Router(<span class="hljs-keyword">this</span>.name, <span class="hljs-keyword">this</span>.routes);
    <span class="hljs-keyword">this</span>.router.init();
};

air.App.prototype.model = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(name, params)</span> </span>{
    <span class="hljs-keyword">if</span> (!params) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> air.Model(name, <span class="hljs-keyword">this</span>.modelDefinitions[name]);
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">/* Store the model definition if needed */</span>
        <span class="hljs-keyword">this</span>.modelDefinitions[name] = params;
    }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <h2 id="router">Router</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre>air.Router = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(appName, routes)</span> </span>{
    <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>,
        <span class="hljs-comment">/* Main logic behind the execution of a route */</span>
        routeCallback = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(route)</span> </span>{
            <span class="hljs-keyword">var</span> split = route.url.split(<span class="hljs-string">'/'</span>),
                <span class="hljs-comment">/* Find which controller should handle a given route */</span>
                controllerName = split[<span class="hljs-number">0</span>] || air.settings.DEFAULT_CONTROLLER_NAME,
                <span class="hljs-comment">/* Find which method should be invoked in the controller that handles the given route */</span>
                controllerMethod = split[<span class="hljs-number">1</span>] ? split[<span class="hljs-number">1</span>].split(<span class="hljs-string">'?'</span>)[<span class="hljs-number">0</span>] : air.settings.DEFAULT_CONTROLLER_METHOD,
                controller = air.apps[self.appName].controllers[controllerName];
            controller.invokeMethod(controllerMethod, route.params);
        },
        i, len, route;
    <span class="hljs-keyword">this</span>.appName = appName;

    <span class="hljs-comment">/* Initialize RLite (routing engine) */</span>
    <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.r) {
        <span class="hljs-keyword">this</span>.rlite = <span class="hljs-keyword">new</span> Rlite();
    }

    <span class="hljs-comment">/* Empty routes are handled through the default action in the default controller */</span>
    <span class="hljs-keyword">if</span> (routes.indexOf(air.settings.DEFAULT_CONTROLLER_NAME) &gt; -<span class="hljs-number">1</span>){
        routes.push(<span class="hljs-string">''</span>);
    }

    <span class="hljs-comment">/* Register each route */</span>
    <span class="hljs-keyword">for</span> (i=<span class="hljs-number">0</span>, len=routes.length; i&lt;len; i++) {
        route = routes[i];
        <span class="hljs-keyword">this</span>.rlite.add(route, routeCallback);
    }
};

air.Router.prototype.run = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(route)</span> </span>{
    <span class="hljs-keyword">this</span>.rlite.run(route);
};

air.Router.prototype.init = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-comment">/* Hash-based routing */</span>
    <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>,
        processHash = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
            <span class="hljs-keyword">var</span> hash = location.hash || <span class="hljs-string">'#'</span>;
            self.rlite.run(hash.substr(<span class="hljs-number">1</span>));
        };

    <span class="hljs-built_in">window</span>.addEventListener(<span class="hljs-string">'hashchange'</span>, processHash);
    processHash();
};</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <h2 id="model">Model</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre>air.Model = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(name, params)</span> </span>{
    params = params || {};
    <span class="hljs-keyword">this</span>.name = name;
    <span class="hljs-keyword">this</span>.attributes = params.attributes || {};
    <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;

    <span class="hljs-comment">/* Generate model methods for each given endpoint */</span>
    air.each(params, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(value, property)</span></span>{
        <span class="hljs-keyword">var</span> split, httpMethod, url;
        <span class="hljs-keyword">if</span> (air.isString(value)){
            split = value.split(<span class="hljs-string">' '</span>);
            httpMethod = split[<span class="hljs-number">0</span>];
            url = split[<span class="hljs-number">1</span>];
            self[property] = self.endpointMethod(httpMethod, url);
        }
    });
};</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>Generate a model method which will perform an ajax request
for a given endpoint</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>air.Model.prototype.endpointMethod = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(httpMethod, url)</span> </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(params, success, error)</span> </span>{
        <span class="hljs-keyword">var</span> urlAfterReplacement = url,
            attributes = <span class="hljs-keyword">this</span>.attributes,
            attribute, param;
        <span class="hljs-comment">/* Replace attributes in URL */</span>
        <span class="hljs-keyword">for</span> (attribute <span class="hljs-keyword">in</span> attributes) {
            urlAfterReplacement = urlAfterReplacement.replace(<span class="hljs-string">'{'</span> + attribute + <span class="hljs-string">'}'</span>, attributes[attribute]);
        }
        <span class="hljs-comment">/* Replace params in URL */</span>
        <span class="hljs-keyword">for</span> (param <span class="hljs-keyword">in</span> params) {
            urlAfterReplacement = urlAfterReplacement.replace(<span class="hljs-string">'{'</span> + param + <span class="hljs-string">'}'</span>, params[param]);
        }
        <span class="hljs-keyword">return</span> air.ajax({
            url: urlAfterReplacement,
            type: httpMethod,
            data: params,
            success: success,
            error: error
        });
    };
};</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <h2 id="controller">Controller</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre>air.Controller = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(name, methods)</span> </span>{
    <span class="hljs-keyword">this</span>.name = name;
    <span class="hljs-keyword">this</span>.methods = methods || {};
};

air.Controller.prototype.invokeMethod = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(methodName, params)</span> </span>{
    <span class="hljs-keyword">var</span> method = <span class="hljs-keyword">this</span>.methods[methodName],
        result, defaultView, defaultViewName;
    <span class="hljs-keyword">if</span> (method) {
        <span class="hljs-comment">/* Invoke the method with the given parameters */</span>
        result = method.call(<span class="hljs-keyword">this</span>, params);
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">/* Default behavior: check for a default template and render it.
         * The default template should be called controllerName/methodName or
         * simply controllerName if methodName is the default one.
         */</span>
        defaultViewName = <span class="hljs-keyword">this</span>.name;
        <span class="hljs-keyword">if</span> (methodName &amp;&amp; methodName != air.settings.DEFAULT_CONTROLLER_METHOD) {
            defaultViewName += <span class="hljs-string">'/'</span> + methodName;
        }
        result = <span class="hljs-keyword">new</span> air.View(defaultViewName, {templateData: params, controller: <span class="hljs-keyword">this</span>});
    }
    <span class="hljs-comment">/* If a view was returned, render it */</span>
    <span class="hljs-keyword">if</span> (result &amp;&amp; result.constructor === air.View) {
        <span class="hljs-comment">/* If the controller's method execution resulted in the creation of a view,
         * store this information in the view itself.
         */</span>
        result.controller = result.controller || <span class="hljs-keyword">this</span>;
        result.render();
    }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <h2 id="template">Template</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre>air.Template = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(name, tmpl)</span> </span>{
    <span class="hljs-keyword">this</span>.name = name;
    <span class="hljs-keyword">if</span> (air.isFunction(tmpl)) {</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>Allow for pre-compiled funcions</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">this</span>.compile = tmpl;
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">this</span>.templateId = tmpl || (<span class="hljs-string">'script[data-air="'</span> + name + <span class="hljs-string">'"]'</span>);
    }
};

air.Template.prototype.cache = [];

air.Template.prototype.compile = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">compile</span><span class="hljs-params">(model)</span> </span>{
    <span class="hljs-comment">/* Figure out if we're getting a template, or if we need to
     * load the template - and be sure to cache the result.
     */</span>
    <span class="hljs-keyword">var</span> str = <span class="hljs-keyword">this</span>.cache[<span class="hljs-keyword">this</span>.name] || air.$(<span class="hljs-keyword">this</span>.templateId).element.innerHTML,
        fn = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Function</span>(<span class="hljs-string">"obj"</span>,
            <span class="hljs-string">"var p=[],print=function(){p.push.apply(p,arguments);};"</span> +

            <span class="hljs-comment">/* Introduce the data as local variables using with(){} */</span>
            <span class="hljs-string">"with(obj){p.push('"</span> +

            <span class="hljs-comment">/* Convert the template into pure JavaScript */</span>
            str
            .replace(<span class="hljs-regexp">/[\r\t\n]/g</span>, <span class="hljs-string">" "</span>)
            .split(<span class="hljs-string">"&lt;%"</span>).join(<span class="hljs-string">"\t"</span>)
            .replace(<span class="hljs-regexp">/((^|%&gt;)[^\t]*)'/g</span>, <span class="hljs-string">"$1\r"</span>)
            .replace(<span class="hljs-regexp">/\t=(.*?)%&gt;/g</span>, <span class="hljs-string">"',$1,'"</span>)
            .split(<span class="hljs-string">"\t"</span>).join(<span class="hljs-string">"');"</span>)
            .split(<span class="hljs-string">"%&gt;"</span>).join(<span class="hljs-string">"p.push('"</span>)
            .split(<span class="hljs-string">"\r"</span>).join(<span class="hljs-string">"\\'"</span>) + <span class="hljs-string">"');}return p.join('');"</span>);

    <span class="hljs-comment">/* Provide some basic currying to the user */</span>
    <span class="hljs-keyword">return</span> fn(model.attributes);
};</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <h2 id="view">View</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre>air.View = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(name, options)</span> </span>{
    <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;
    options = options || {};
    <span class="hljs-keyword">this</span>.name = name;
    <span class="hljs-keyword">this</span>.el = options.el || (<span class="hljs-string">':not(script)[data-air="'</span> + name + <span class="hljs-string">'"]'</span>);
    <span class="hljs-keyword">this</span>.model = options.model || <span class="hljs-keyword">new</span> air.Model(name);
    <span class="hljs-keyword">this</span>.template = <span class="hljs-keyword">new</span> air.Template(name, options.template);
    <span class="hljs-keyword">this</span>.controller = options.controller;
    <span class="hljs-keyword">this</span>.events = options.events || {};
    air.each(<span class="hljs-keyword">this</span>.events, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(action, key)</span> </span>{
        self.addEvent(key, action);
    });
};

air.View.prototype.render = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">var</span> viewElement = air.$(<span class="hljs-keyword">this</span>.el),
        compiledTemplate = <span class="hljs-keyword">this</span>.template.compile(<span class="hljs-keyword">this</span>.model),
        events = <span class="hljs-keyword">this</span>.events,
        self = <span class="hljs-keyword">this</span>;
    viewElement.html(compiledTemplate);
    air.each(events, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(eventKey, event)</span></span>{
        self.addEvent(eventKey, event);
    });
};

air.View.prototype.addEvent = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(eventKey, eventAction)</span> </span>{
    <span class="hljs-keyword">var</span> eventKeySplit, eventElement, eventTrigger;
    eventKeySplit = eventKey.split(<span class="hljs-string">' '</span>);
    eventElement = eventKeySplit[<span class="hljs-number">1</span>];
    eventTrigger = eventKeySplit[<span class="hljs-number">0</span>];
    <span class="hljs-keyword">if</span> (air.isString(eventAction)) {</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p>TODO: Finish, test</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        eventAction = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(params)</span> </span>{
            <span class="hljs-keyword">this</span>.controller.invokeMethod(eventAction, params);
        };
    }
    air.$(eventElement).on(eventTrigger, eventAction);
};

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Rlite</span><span class="hljs-params">()</span></span>{<span class="hljs-keyword">this</span>.rules={}}Rlite.prototype={add:<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(n,t)</span></span>{<span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> r,u,e=n.split(<span class="hljs-string">"/"</span>),i=<span class="hljs-keyword">this</span>.rules,f=<span class="hljs-number">0</span>;f&lt;e.length;++f)r=e[f],u=r.length&amp;&amp;r.charAt(<span class="hljs-number">0</span>)==<span class="hljs-string">":"</span>?<span class="hljs-string">":"</span>:r,i[u]?i=i[u]:(i=i[u]={},u==<span class="hljs-string">":"</span>&amp;&amp;(i[<span class="hljs-string">"@name"</span>]=r.substr(<span class="hljs-number">1</span>,r.length-<span class="hljs-number">1</span>)));i[<span class="hljs-string">"@"</span>]=t},run:<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(n)</span></span>{n&amp;&amp;n.length&amp;&amp;(n=n.replace(<span class="hljs-string">"/?"</span>,<span class="hljs-string">"?"</span>),n.charAt(<span class="hljs-number">0</span>)==<span class="hljs-string">"/"</span>&amp;&amp;(n=n.substr(<span class="hljs-number">1</span>,n.length)),n.length&amp;&amp;n.charAt(n.length-<span class="hljs-number">1</span>)==<span class="hljs-string">"/"</span>&amp;&amp;(n=n.substr(<span class="hljs-number">0</span>,n.length-<span class="hljs-number">1</span>)));<span class="hljs-keyword">var</span> t=<span class="hljs-keyword">this</span>.rules,i=n.split(<span class="hljs-string">"?"</span>,<span class="hljs-number">2</span>),u=i[<span class="hljs-number">0</span>].split(<span class="hljs-string">"/"</span>,<span class="hljs-number">50</span>),r={};<span class="hljs-keyword">return</span>(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{<span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> n=<span class="hljs-number">0</span>;n&lt;u.length&amp;&amp;t;++n){<span class="hljs-keyword">var</span> f=u[n],e=f.toLowerCase(),i=t[e];!i&amp;&amp;(i=t[<span class="hljs-string">":"</span>])&amp;&amp;(r[i[<span class="hljs-string">"@name"</span>]]=f);t=i}}(),<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(n)</span></span>{<span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> t,u=n.split(<span class="hljs-string">"&amp;"</span>,<span class="hljs-number">50</span>),i=<span class="hljs-number">0</span>;i&lt;u.length;++i)t=u[i].split(<span class="hljs-string">"="</span>,<span class="hljs-number">2</span>),t.length==<span class="hljs-number">2</span>&amp;&amp;(r[t[<span class="hljs-number">0</span>]]=t[<span class="hljs-number">1</span>])}(i.length==<span class="hljs-number">2</span>?i[<span class="hljs-number">1</span>]:<span class="hljs-string">""</span>),t&amp;&amp;t[<span class="hljs-string">"@"</span>])?(t[<span class="hljs-string">"@"</span>]({url:n,params:r}),!<span class="hljs-number">0</span>):!<span class="hljs-number">1</span>}};</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
